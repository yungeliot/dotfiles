/*! For license information please see processor.js.LICENSE.txt */
(()=>{var e={42215:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WatcherHandler=void 0,function(e){e.onLoad="onLoad",e.onClick="onClick",e.onIframeLoaded="onIframeLoaded",e.onUrlChanged="onUrlChanged",e.onPostMessage="onPostMessage",e.onWindowLoad="onWindowLoad",e.onDomLoad="onDomLoad",e.onDomChanged="onDomChanged"}(t.WatcherHandler||(t.WatcherHandler={}))},42327:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InternalMessageBgType=t.MessageBgType=void 0,function(e){e.INIT="INIT",e.RE_INIT="RE_INIT",e.IFRAME_LOADED="IFRAME_LOADED"}(t.MessageBgType||(t.MessageBgType={})),function(e){e.TRACK="ECOMMERCE_INTERNAL_TRACK",e.ERROR_TRACE="ECOMMERCE_ERROR_TRACE"}(t.InternalMessageBgType||(t.InternalMessageBgType={}))},11468:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;const a=n(63580),c=n(75470);let s=class{constructor(e){this.config=e,this.loggerLabel="%c[ECOMMERCE]",this.loggerLabelStyle="background-color: lightgreen; font-weight: bold; padding: 2px;"}log(e,...t){this.config.logging}error(e,...t){this.config.logging}};s=r([(0,a.injectable)(),o(0,(0,a.inject)(c.ConfigInjections.config)),i("design:paramtypes",[Object])],s),t.Logger=s},75470:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigInjections=void 0,function(e){e.config="config"}(t.ConfigInjections||(t.ConfigInjections={}))},1106:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseUrl=t.debounce=t.DEFAULT_DEBOUNCE_TIME=t.pipe=t.uuid=t.isIframe=void 0,t.isIframe=function(){try{return window.self!==window.top}catch{return!0}},t.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))};t.pipe=(...e)=>t=>e.reduce(((e,t)=>t(e)),t),t.DEFAULT_DEBOUNCE_TIME=150;t.debounce=(e,n=t.DEFAULT_DEBOUNCE_TIME)=>{let r=0;return(...t)=>{clearTimeout(r),r=setTimeout((()=>e(...t)),n)}};t.parseUrl=e=>{try{return new URL(e)}catch{return e}}},36769:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.Matcher=void 0;const i=n(63580);let o=class{isDataMatches(e,t=[]){return!t?.length||t.some((t=>{const n=this.dataStrategies[t.type];if(!n)throw new Error(`Matcher: Not correct schema type "${t.type}".`);return n(e,t)}))}isUrlMatches({regex:e},t){return new RegExp(e,"i").test(t)}primitiveStrategies(e,{type:t,value:n}){return!(typeof e!==t.toLowerCase())&&(void 0===n||n.some((t=>t===e)))}get dataStrategies(){return{Number:this.primitiveStrategies,String:this.primitiveStrategies,Boolean:this.primitiveStrategies,Null:e=>null===e,Undefined:e=>void 0===e,Array:(e,{value:t,min:n,max:r})=>!!Array.isArray(e)&&(!(void 0!==n&&e.length<n)&&(!(void 0!==r&&e.length>r)&&(void 0===t||t.some((t=>e.every((e=>this.isDataMatches(e,[t])))))))),Object:(e,{value:t})=>!(!(e instanceof Object)||Array.isArray(e))&&(void 0===t||t.some((t=>{const n=Object.entries(t);return 0===n.length?0===Object.keys(e).length:n.every((([t,n])=>e.hasOwnProperty(t)&&this.isDataMatches(e[t],[n])))})))}}};o=r([(0,i.injectable)()],o),t.Matcher=o},11272:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.Observer=void 0;const i=n(63580);let o=class{constructor(){this.listeners={}}emit(e,t){if(!this.listeners[e])return;this.listeners[e].forEach((e=>{e(t)}))}subscribe(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}clear(){this.listeners={}}};o=r([(0,i.injectable)()],o),t.Observer=o},34679:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryManager=void 0;const a=n(11272),c=n(46444),s=n(63580),u=n(62825);var l;!function(e){e.URL_CHANGED="URL_CHANGED",e.SHOPIFY_DETECTED="SHOPIFY_DETECTED"}(l||(l={}));let f=class{constructor(e){this.observer=e,this.scriptAttribute="extend-native-history-api",this.scriptPath="libs/extend-native-history-api.js";const t={[c.MessageScriptType.CUSTOM_ON_URL_CHANGED]:()=>{this.observer.emit(l.URL_CHANGED,location.href)},[c.MessageScriptType.SHOPIFY_DETECTED]:e=>{this.observer.emit(l.SHOPIFY_DETECTED,e.data.payload)}};window.addEventListener("message",(e=>{t[e.data._custom_type_]?.(e)}))}replaceNativeApi(){if(this.isHistoryScriptInjected())return;const e=document.createElement("script");e.src=chrome.runtime.getURL(this.scriptPath),(document.head||document.documentElement).append(e)}onUrlChanged(e){this.observer.subscribe(l.URL_CHANGED,e)}onShopifyDetected(e){this.observer.subscribe(l.SHOPIFY_DETECTED,e)}isHistoryScriptInjected(){const e=Boolean(document.querySelector(`script[ecommerce-type="${this.scriptAttribute}"]`)),t=Boolean(document.querySelector(`script[src*="${this.scriptPath}"]`));return e||t}};f=r([(0,s.injectable)(),o(0,(0,s.inject)(u.ContentInjections.observer)),i("design:paramtypes",[a.Observer])],f),t.HistoryManager=f},90208:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.RequestsManager=void 0;const a=n(11272),c=n(46444),s=n(63580),u=n(62825);var l;!function(e){e.SAVE_HTTP_DATA="SAVE_HTTP_DATA"}(l||(l={}));let f=class{constructor(e){this.observer=e,this.scriptAttribute="requests",this.scriptPath="libs/requests.js";const t={[c.MessageScriptType.SAVE_HTTP_DATA]:e=>{const t={...e.data.payload};this.observer.emit(l.SAVE_HTTP_DATA,t)}};window.addEventListener("message",(e=>{t[e.data._custom_type_]?.(e)}))}injectConfig(e=[],t=[]){(()=>{const n={_custom_type_:c.MessageScriptType.INIT_HTTP_CONFIG,payload:{onHttpRequest:e,onHttpResponse:t}};window.postMessage(n)})()}injectScript(){if(this.isRequestsScriptInjected())return;const e=document.createElement("script");e.src=chrome.runtime.getURL(this.scriptPath);(document.head||document.documentElement).append(e)}onHttpDataSave(e){this.observer.subscribe(l.SAVE_HTTP_DATA,e)}isRequestsScriptInjected(){const e=Boolean(document.querySelector(`script[ecommerce-type="${this.scriptAttribute}"]`)),t=Boolean(document.querySelector(`script[src*="${this.scriptPath}"]`));return e||t}};f=r([(0,s.injectable)(),o(0,(0,s.inject)(u.ContentInjections.observer)),i("design:paramtypes",[a.Observer])],f),t.RequestsManager=f},62825:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContentInjections=void 0,function(e){e.contentStorage="contentStorage",e.requestsManager="requestsManager",e.inContentMessageManager="inContentMessageManager",e.outContentMessageManager="outContentMessageManager",e.historyManager="historyManager",e.extractorManager="extractorManager",e.observer="observer",e.logger="logger",e.matcher="matcher",e.ID="CONTENT_ID",e.DI="CONTENT_INJECTION",e.activeConfig="activeConfig",e.interceptorsHandler="interceptorsHandler",e.onClickHandler="onClickHandler",e.onDomLoadHandler="onDomLoadHandler",e.onIframeLoadedHandler="onIframeLoadedHandler",e.onLoadHandler="onLoadHandler",e.onPostMessageHandler="onPostMessageHandler",e.onUrlChangedHandler="onUrlChangedHandler",e.onWindowLoadHandler="onWindowLoadHandler",e.onDomChangedHandler="onDomChangedHandler"}(t.ContentInjections||(t.ContentInjections={}))},24940:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RESERVED_VARIABLES=void 0,function(e){e.$url="$url",e.$shopify="$shopify",e.$event="$event",e.$element="$element",e.$parent="$parent",e.$child="$child",e.$data="$data",e.$scope="$scope"}(t.RESERVED_VARIABLES||(t.RESERVED_VARIABLES={}))},74990:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ExtractorManager=t.ExtractorEvents=void 0;const a=n(40233),c=n(93176),s=n(14476),u=n(63580),l=n(62825),f=n(75470);var d;!function(e){e.RUNTIME_STORAGE_SAVE="@runtime.storage.save"}(d=t.ExtractorEvents||(t.ExtractorEvents={}));let p=class{constructor(e,t){this.outMessageManager=e,this.container=t}run(e,t,n={}){const r=this.makeExtractor(e.operations,document,n),{initialUrl:i,marketplace:o}=this.libConfig()??{},a={marketplace:o.name,templateVersion:o.version,event:e.event,url:i,title:document.title,lang:document.documentElement.lang},s={[c.ExtractorResponseStatus.SUCCESS]:({response:t})=>{this.outMessageManager.trackMessage({...a,data:t},e.customEvent)},[c.ExtractorResponseStatus.FAILED]:({response:n})=>{this.outMessageManager.errorTraceMessage(n,t,e,i)},[c.ExtractorResponseStatus.INTERRUPTED]:()=>null};setTimeout((async()=>{const e=await r.run();s[e.status]?.(e)}),e.waitMs??0)}get config(){return{log:this.libConfig().logging}}makeExtractor(e,t,n){const r={...this.storage().getStorage(),...n},i=new a.Extractor(this.config,e,t,r,this.watcher().config.func);return i.on(d.RUNTIME_STORAGE_SAVE,this.onRuntimeStorageSaveExtractorEvent.bind(this)),i}onRuntimeStorageSaveExtractorEvent([e,t]){this.storage().save(e,t),this.outMessageManager.runtimeStorageSaveMessage(e,t)}libConfig(){return this.container.get(f.ConfigInjections.config)}storage(){return this.container.get(l.ContentInjections.contentStorage)}watcher(){return this.container.get(l.ContentInjections.activeConfig)}};p=r([(0,u.injectable)(),o(0,(0,u.inject)(l.ContentInjections.outContentMessageManager)),o(1,(0,u.inject)(l.ContentInjections.DI)),i("design:paramtypes",[s.OutContentMessageManager,u.Container])],p),t.ExtractorManager=p},99808:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.InterceptorsHandler=void 0;const a=n(63580),c=n(62825),s=n(90208);let u=class{constructor(e,t){this.container=e,this.requestsManager=t,this.requestsManager.onHttpDataSave(this.onHttpDataSave.bind(this))}handle(){const{onHttpRequest:e=[],onHttpResponse:t=[]}=this.watcher()?.config??{};(e.length>0||t.length>0)&&this.requestsManager.injectConfig(e,t)}onHttpDataSave(e){this.storage().upsert(e.variable,e.payload)}watcher(){return this.container.get(c.ContentInjections.activeConfig)}storage(){return this.container.get(c.ContentInjections.contentStorage)}};u=r([(0,a.injectable)(),o(0,(0,a.inject)(c.ContentInjections.DI)),o(1,(0,a.inject)(c.ContentInjections.requestsManager)),i("design:paramtypes",[a.Container,s.RequestsManager])],u),t.InterceptorsHandler=u},50838:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OnClickHandler=void 0;const a=n(63580),c=n(42215),s=n(62825),u=n(74990),l=n(24940);let f=class{constructor(e,t){this.container=e,this.extractor=t}handle(){document.addEventListener("click",this.clickHandler.bind(this),{capture:!0})}watcher(){return this.container.get(s.ContentInjections.activeConfig)}logger(){return this.container.get(s.ContentInjections.logger)}clickHandler(e){this.watcher()?.config?.onClick?.forEach((t=>{try{if(e.target.matches(t.selector)){const n={[l.RESERVED_VARIABLES.$element]:e.target,[l.RESERVED_VARIABLES.$event]:e};this.extractor?.run?.(t,c.WatcherHandler.onClick,n)}}catch(e){this.logger().error(`\n Handler: "${c.WatcherHandler.onClick}". \n Event: "${t.event}". \n Error: "${e.message}"`)}}))}};f=r([(0,a.injectable)(),o(0,(0,a.inject)(s.ContentInjections.DI)),o(1,(0,a.inject)(s.ContentInjections.extractorManager)),i("design:paramtypes",[a.Container,u.ExtractorManager])],f),t.OnClickHandler=f},1457:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OnDomChangedHandler=void 0;const a=n(63580),c=n(42215),s=n(62825),u=n(74990),l=n(24940);let f=class{constructor(e,t){this.container=e,this.extractor=t,this.existingObservers=[]}handle(){this.cleanObservers(),this.onDomChanged()?.length&&("complete"!==document.readyState?window.addEventListener("load",this.extractDomChangedListener.bind(this)):this.extractDomChangedListener())}cleanObservers(){this.existingObservers.forEach((e=>{e.disconnect()})),this.existingObservers=[]}watcher(){return this.container.get(s.ContentInjections.activeConfig)}logger(){return this.container.get(s.ContentInjections.logger)}onDomChanged(){return this.watcher()?.config?.onDomChanged??[]}logError(e,t){this.logger().error(`\n Handler: "${c.WatcherHandler.onDomChanged}". \n Event: "${e}". \n Error: "${t}"`)}extractDomChangedListener(){this.onDomChanged().forEach((e=>{const{parent:t,action:n,child:r,options:i=this.defaultOptions}=e;if(r)if(n)try{const n=document.querySelector(t),r=n instanceof HTMLIFrameElement?n.contentWindow.document:n;if(!r)return void this.logError(e.event,`No element found with selector: "${t}"`);const o=new MutationObserver(this.mutationCallback(e).bind(this));o.observe(r,i),this.existingObservers.push(o)}catch(t){this.logError(e.event,t.message)}else this.logError(e.event,'"Action" property was not provided');else this.logError(e.event,'"Child" property was not provided')}))}mutationCallback(e){const{action:t}=e;return(n,r)=>{const i={ADD:"addedNodes",REMOVE:"removedNodes"}[t];if(!i)return this.logError(e.event,`Action "${t}" is not acceptable. Use "ADD" or "REMOVE"`),void r.disconnect();this.proceedNodes(n,i,e)}}proceedNodes(e,t,n){for(const r of e)0!==r[t].length&&r[t].forEach((e=>{try{if(e.matches?.(n.child)){const t={[l.RESERVED_VARIABLES.$parent]:r.target,[l.RESERVED_VARIABLES.$child]:e};this.extractor?.run?.(n,c.WatcherHandler.onDomChanged,t)}}catch(e){this.logError(n.event,e.message)}}))}get defaultOptions(){return{childList:!0,subtree:!0}}};f=r([(0,a.injectable)(),o(0,(0,a.inject)(s.ContentInjections.DI)),o(1,(0,a.inject)(s.ContentInjections.extractorManager)),i("design:paramtypes",[a.Container,u.ExtractorManager])],f),t.OnDomChangedHandler=f},4234:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OnDomLoadHandler=void 0;const a=n(63580),c=n(1106),s=n(42215),u=n(62825),l=n(74990);let f=class{constructor(e,t){this.container=e,this.extractor=t}handle(){(0,c.isIframe)()||(["interactive","complete"].includes(document.readyState)?this.extractDomLoadHandlers():document.addEventListener("DOMContentLoaded",this.extractDomLoadHandlers.bind(this)))}extractDomLoadHandlers(){this.watcher()?.config?.onDomLoad?.forEach((e=>{this.extractor?.run?.(e,s.WatcherHandler.onDomLoad)}))}watcher(){return this.container.get(u.ContentInjections.activeConfig)}};f=r([(0,a.injectable)(),o(0,(0,a.inject)(u.ContentInjections.DI)),o(1,(0,a.inject)(u.ContentInjections.extractorManager)),i("design:paramtypes",[a.Container,l.ExtractorManager])],f),t.OnDomLoadHandler=f},43335:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OnIframeLoadedHandler=void 0;const a=n(63580),c=n(42215),s=n(62825),u=n(74990),l=n(1106),f=n(36769);let d=class{constructor(e,t,n){this.container=e,this.extractor=t,this.matcher=n}handle({payload:e}){if((0,l.isIframe)())return;const{url:t}=e;this.watcher()?.config?.onIframeLoaded?.forEach((e=>{this.matcher.isUrlMatches(e,t)&&this.extractor?.run?.(e,c.WatcherHandler.onIframeLoaded)}))}watcher(){try{return this.container.get(s.ContentInjections.activeConfig)}catch{return{}}}};d=r([(0,a.injectable)(),o(0,(0,a.inject)(s.ContentInjections.DI)),o(1,(0,a.inject)(s.ContentInjections.extractorManager)),o(2,(0,a.inject)(s.ContentInjections.matcher)),i("design:paramtypes",[a.Container,u.ExtractorManager,f.Matcher])],d),t.OnIframeLoadedHandler=d},82134:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OnLoadHandler=void 0;const a=n(63580),c=n(1106),s=n(42215),u=n(62825),l=n(74990);let f=class{constructor(e,t){this.container=e,this.extractor=t}handle(){(0,c.isIframe)()||this.watcher()?.config?.onLoad?.forEach((e=>{this.extractor?.run?.(e,s.WatcherHandler.onLoad)}))}watcher(){return this.container.get(u.ContentInjections.activeConfig)}};f=r([(0,a.injectable)(),o(0,(0,a.inject)(u.ContentInjections.DI)),o(1,(0,a.inject)(u.ContentInjections.extractorManager)),i("design:paramtypes",[a.Container,l.ExtractorManager])],f),t.OnLoadHandler=f},47016:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OnPostMessageHandler=void 0;const a=n(63580),c=n(42215),s=n(62825),u=n(74990),l=n(36769),f=n(24940);let d=class{constructor(e,t,n){this.container=e,this.extractor=t,this.matcher=n}handle(){window.addEventListener("message",this.listener.bind(this))}watcher(){return this.container.get(s.ContentInjections.activeConfig)}listener({data:e,origin:t,source:n}){this.watcher()?.config?.onPostMessage?.forEach((r=>{const i=this.matcher.isUrlMatches(r,t),o=this.matcher.isDataMatches(e,r.schemas);if(!i||!o)return;let a={[f.RESERVED_VARIABLES.$data]:e};try{a={...a,[f.RESERVED_VARIABLES.$scope]:n.document}}catch{a={...a,[f.RESERVED_VARIABLES.$scope]:document}}this.extractor?.run?.(r,c.WatcherHandler.onPostMessage,a)}))}};d=r([(0,a.injectable)(),o(0,(0,a.inject)(s.ContentInjections.DI)),o(1,(0,a.inject)(s.ContentInjections.extractorManager)),o(2,(0,a.inject)(s.ContentInjections.matcher)),i("design:paramtypes",[a.Container,u.ExtractorManager,l.Matcher])],d),t.OnPostMessageHandler=d},21042:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OnUrlChangedHandler=void 0;const a=n(63580),c=n(42215),s=n(62825),u=n(74990),l=n(36769),f=n(1106),d=n(34679),p=n(75470),h=n(14476),y=n(24940);let g=class{constructor(e,t,n,r,i){this.container=e,this.extractor=t,this.matcher=n,this.history=r,this.outMessageManager=i;this.urlChanged=(0,f.debounce)((e=>{const t=this.config();if(e===t?.initialUrl)return;if(this.log(`URL changed: "${e}"`),this.updateUrl(e),this.watcher()?.config?.onUrlChanged?.forEach((t=>{this.matcher.isUrlMatches(t,e)&&this.extractor?.run?.(t,c.WatcherHandler.onUrlChanged)})),(0,f.isIframe)())return;const n=this.watcher()?.detectUrlChanges??t?.marketplace?.detectUrlChanges;if(!n)return;if(!Array.isArray(n))return void this.outMessageManager.reInitMessage();n.some((t=>this.matcher.isUrlMatches({regex:t},e)))&&this.outMessageManager.reInitMessage()}))}handle(){this.history.onUrlChanged(this.urlChanged.bind(this))}updateUrl(e){const t={...this.config(),initialUrl:e};this.container.rebind(p.ConfigInjections.config).toConstantValue(t),this.storage().save(y.RESERVED_VARIABLES.$url,(0,f.parseUrl)(e))}log(e,...t){const n=this.container.get(s.ContentInjections.logger);n?.log?.(e,...t)}config(){return this.container.get(p.ConfigInjections.config)}watcher(){return this.container.get(s.ContentInjections.activeConfig)}storage(){return this.container.get(s.ContentInjections.contentStorage)}};g=r([(0,a.injectable)(),o(0,(0,a.inject)(s.ContentInjections.DI)),o(1,(0,a.inject)(s.ContentInjections.extractorManager)),o(2,(0,a.inject)(s.ContentInjections.matcher)),o(3,(0,a.inject)(s.ContentInjections.historyManager)),o(4,(0,a.inject)(s.ContentInjections.outContentMessageManager)),i("design:paramtypes",[a.Container,u.ExtractorManager,l.Matcher,d.HistoryManager,h.OutContentMessageManager])],g),t.OnUrlChangedHandler=g},71168:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OnWindowLoadHandler=void 0;const a=n(63580),c=n(1106),s=n(42215),u=n(62825),l=n(74990);let f=class{constructor(e,t){this.container=e,this.extractor=t}handle(){(0,c.isIframe)()||("complete"!==document.readyState?window.addEventListener("load",this.extractWindowLoadHandlers.bind(this)):this.extractWindowLoadHandlers())}extractWindowLoadHandlers(){this.watcher()?.config?.onWindowLoad?.forEach((e=>{this.extractor?.run?.(e,s.WatcherHandler.onWindowLoad)}))}watcher(){return this.container.get(u.ContentInjections.activeConfig)}};f=r([(0,a.injectable)(),o(0,(0,a.inject)(u.ContentInjections.DI)),o(1,(0,a.inject)(u.ContentInjections.extractorManager)),i("design:paramtypes",[a.Container,l.ExtractorManager])],f),t.OnWindowLoadHandler=f},91049:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.InContentMessageManager=void 0;const a=n(42327),c=n(97044),s=n(63580),u=n(62825),l=n(11468),f=n(75470),d=n(36769),p=n(99808),h=n(50838),y=n(82134),g=n(4234),v=n(71168),m=n(47016),b=n(21042),_=n(43335),w=n(1457),R=n(1106),j=n(24940);let O=class{constructor(e,t,n,r,i,o,a,c,s,u,l,f){this.container=e,this.id=t,this.matcher=n,this.interceptors=r,this.click=i,this.load=o,this.domLoad=a,this.windowLoad=c,this.postMessage=s,this.urlChanged=u,this.iframeLoaded=l,this.onDomChanged=f,chrome.runtime.onMessage.addListener(this.bindListeners.bind(this))}onInit(e){const{payload:t}=e,{libConfig:n,watcher:r,varScope:i}=t;try{if(document.body.getAttribute(this.processedFlagAttribute))return}catch(t){return void setTimeout((()=>{this.onInit(e)}),100)}this.watcher=r,this.libConfig=n,this.initAdditionalDependencies(),document.body.setAttribute(this.processedFlagAttribute,"true"),this.initStorage(i),this.initHandlers(a.MessageBgType.INIT)}onReInit({payload:e}){if((0,R.isIframe)())return;const{initialUrl:t,watcher:n,varScope:r}=e;this.libConfig.initialUrl=t;const i=JSON.stringify(this.watcher)!==JSON.stringify(n);i&&(this.watcher=n,this.container.rebind(u.ContentInjections.activeConfig).toConstantValue(this.watcher)),this.initStorage(r),this.initHandlers(a.MessageBgType.RE_INIT,i)}initHandlers(e,t=!0){const n={[a.MessageBgType.INIT]:()=>{this.load.handle(),this.domLoad.handle(),this.windowLoad.handle(),this.click.handle(),this.urlChanged.handle(),this.postMessage.handle(),this.interceptors.handle(),this.onDomChanged.handle()},[a.MessageBgType.RE_INIT]:(e=!0)=>{this.load.handle(),this.domLoad.handle(),this.windowLoad.handle(),e&&(this.interceptors.handle(),this.onDomChanged.handle())}};n[e]?.(t)}initStorage(e){const t={...e,...{[j.RESERVED_VARIABLES.$url]:(0,R.parseUrl)(this.libConfig.initialUrl)}};this.storage.initStorage(t)}bindListeners(e,t,n){const r={[a.MessageBgType.INIT]:this.onInit.bind(this),[a.MessageBgType.IFRAME_LOADED]:this.iframeLoaded.handle.bind(this.iframeLoaded),[a.MessageBgType.RE_INIT]:this.onReInit.bind(this)};r[e.type]?r[e.type](e):this.log("Ignored message",e)}initAdditionalDependencies(){this.container.bind(f.ConfigInjections.config).toConstantValue(this.libConfig),this.container.bind(u.ContentInjections.activeConfig).toConstantValue(this.watcher),this.container.bind(u.ContentInjections.logger).to(l.Logger).inSingletonScope(),this.container.bind(u.ContentInjections.contentStorage).to(c.ContentStorage).inSingletonScope(),this.storage=this.container.get(u.ContentInjections.contentStorage),this.logger=this.container.get(u.ContentInjections.logger)}get processedFlagAttribute(){return`__processed_${this.id}__`}log(e,...t){this.logger?.log?.(e,...t)}};O=r([(0,s.injectable)(),o(0,(0,s.inject)(u.ContentInjections.DI)),o(1,(0,s.inject)(u.ContentInjections.ID)),o(2,(0,s.inject)(u.ContentInjections.matcher)),o(3,(0,s.inject)(u.ContentInjections.interceptorsHandler)),o(4,(0,s.inject)(u.ContentInjections.onClickHandler)),o(5,(0,s.inject)(u.ContentInjections.onLoadHandler)),o(6,(0,s.inject)(u.ContentInjections.onDomLoadHandler)),o(7,(0,s.inject)(u.ContentInjections.onWindowLoadHandler)),o(8,(0,s.inject)(u.ContentInjections.onPostMessageHandler)),o(9,(0,s.inject)(u.ContentInjections.onUrlChangedHandler)),o(10,(0,s.inject)(u.ContentInjections.onIframeLoadedHandler)),o(11,(0,s.inject)(u.ContentInjections.onDomChangedHandler)),i("design:paramtypes",[s.Container,String,d.Matcher,p.InterceptorsHandler,h.OnClickHandler,y.OnLoadHandler,g.OnDomLoadHandler,v.OnWindowLoadHandler,m.OnPostMessageHandler,b.OnUrlChangedHandler,_.OnIframeLoadedHandler,w.OnDomChangedHandler])],O),t.InContentMessageManager=O},14476:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OutContentMessageManager=void 0;const a=n(46444),c=n(63580),s=n(62825),u=n(75470),l=n(24940);let f=class{constructor(e,t){this.id=e,this.container=t}trackMessage(e,t=!1){const n={id:this.id,type:a.MessageContentType.ECOMMERCE_TRACK,customEvent:t,payload:{...e,clientTs:Date.now()}};this.sendMessage(n)}errorTraceMessage(e,t,n,r){const{handleError:i=!0}=n;if(!i)return void this.logger().log(`TrackError: Listener ${t} was ignored to track error`);const o=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,c=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,{marketplace:s}=this.libConfig(),u=this.watcher(),l={id:this.id,type:a.MessageContentType.ERROR_TRACE,payload:{url:r,window:{height:c,width:o},template:s,trace:e,config:{regex:u.regex,var:u.var,config:{func:u.config.func,[t]:n}}}};this.sendMessage(l)}initMessage(){const e={id:this.id,type:a.MessageContentType.ECOMMERCE_INIT,payload:{url:document.location.href}};this.sendMessage(e)}initShopifyMessage({$shopify:e}){const t={id:this.id,type:a.MessageContentType.ECOMMERCE_INIT_SHOPIFY,payload:{[l.RESERVED_VARIABLES.$shopify]:e,url:document.location.href}};this.sendMessage(t)}reInitMessage(){const e=document.location.href;this.logger().log(`Re-init config for url: "${e}"`);const t=this.storage().getItem(l.RESERVED_VARIABLES.$shopify),n={id:this.id,type:a.MessageContentType.ECOMMERCE_RE_INIT,payload:{url:e,...t&&{[l.RESERVED_VARIABLES.$shopify]:t}}};this.sendMessage(n)}runtimeStorageSaveMessage(e,t){const n={id:this.id,type:a.MessageContentType.ECOMMERCE_RUNTIME_STORAGE_SAVE,payload:{name:e,data:t}};this.sendMessage(n)}sendMessage(e){chrome.runtime.sendMessage(e)}libConfig(){return this.container.get(u.ConfigInjections.config)}logger(){return this.container.get(s.ContentInjections.logger)}watcher(){return this.container.get(s.ContentInjections.activeConfig)}storage(){return this.container.get(s.ContentInjections.contentStorage)}};f=r([(0,c.injectable)(),o(0,(0,c.inject)(s.ContentInjections.ID)),o(1,(0,c.inject)(s.ContentInjections.DI)),i("design:paramtypes",[String,c.Container])],f),t.OutContentMessageManager=f},46444:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageScriptType=t.MessageContentType=void 0,function(e){e.ECOMMERCE_INIT="ECOMMERCE_INIT",e.ECOMMERCE_RE_INIT="ECOMMERCE_RE_INIT",e.ECOMMERCE_TRACK="ECOMMERCE_TRACK",e.ECOMMERCE_RUNTIME_STORAGE_SAVE="ECOMMERCE_RUNTIME_STORAGE_SAVE",e.ERROR_TRACE="ERROR_TRACE",e.ECOMMERCE_INIT_SHOPIFY="ECOMMERCE_INIT_SHOPIFY"}(t.MessageContentType||(t.MessageContentType={})),function(e){e.INIT_HTTP_CONFIG="INIT_HTTP_CONFIG",e.SAVE_HTTP_DATA="SAVE_HTTP_DATA",e.CUSTOM_ON_URL_CHANGED="CUSTOM_ON_URL_CHANGED",e.SHOPIFY_DETECTED="SHOPIFY_DETECTED"}(t.MessageScriptType||(t.MessageScriptType={}))},97044:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ContentStorage=void 0;const a=n(63580),c=n(62825),s=n(11468);let u=class{constructor(e){this.logger=e,this.runtimeStorage=new Map}initStorage(e){this.runtimeStorage=new Map(Object.entries(e))}save(e,t){this.logger.log(`Runtime storage save: key=${e}, value=`,t),this.runtimeStorage.set(e,t)}getStorage(){return Object.fromEntries(this.runtimeStorage)}getItem(e){return this.runtimeStorage.get(e)}upsert(e,t){const n=this.runtimeStorage.has(e)?[...this.getItem(e),t]:[t];this.logger.log("Runtime storage save intercepted data: ",[e,n]),this.runtimeStorage.set(e,n)}};u=r([(0,a.injectable)(),o(0,(0,a.inject)(c.ContentInjections.logger)),i("design:paramtypes",[s.Logger])],u),t.ContentStorage=u},63580:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AsyncContainerModule:()=>ct,BindingScopeEnum:()=>v,BindingTypeEnum:()=>m,Container:()=>ot,ContainerModule:()=>at,LazyServiceIdentifer:()=>z,LazyServiceIdentifier:()=>z,METADATA_KEY:()=>Tt,MetadataReader:()=>H,TargetTypeEnum:()=>b,createTaggedDecorator:()=>ft,decorate:()=>ht,getServiceIdentifierAsString:()=>V,id:()=>w,inject:()=>bt,injectable:()=>yt,interfaces:()=>St,multiBindToService:()=>be,multiInject:()=>Rt,named:()=>vt,namedConstraint:()=>Ge,optional:()=>_t,postConstruct:()=>Et,preDestroy:()=>At,tagged:()=>gt,taggedConstraint:()=>qe,targetName:()=>jt,traverseAncerstors:()=>Ue,typeConstraint:()=>We,unmanaged:()=>wt});var r={};n.r(r),n.d(r,{DESIGN_PARAM_TYPES:()=>p,INJECT_TAG:()=>s,MULTI_INJECT_TAG:()=>u,NAMED_TAG:()=>i,NAME_TAG:()=>o,NON_CUSTOM_TAG_KEYS:()=>g,OPTIONAL_TAG:()=>c,PARAM_TYPES:()=>d,POST_CONSTRUCT:()=>h,PRE_DESTROY:()=>y,TAGGED:()=>l,TAGGED_PROP:()=>f,UNMANAGED_TAG:()=>a});var i="named",o="name",a="unmanaged",c="optional",s="inject",u="multi_inject",l="inversify:tagged",f="inversify:tagged_props",d="inversify:paramtypes",p="design:paramtypes",h="post_construct",y="pre_destroy";var g=[s,u,o,a,i,c],v={Request:"Request",Singleton:"Singleton",Transient:"Transient"},m={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"},b={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"},_=0;function w(){return _++}var R=function(){function e(e,t){this.id=w(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=m.Invalid,this.constraint=function(e){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.onDeactivation=null,this.dynamicValue=null}return e.prototype.clone=function(){var t=new e(this.serviceIdentifier,this.scope);return t.activated=t.scope===v.Singleton&&this.activated,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.factory=this.factory,t.provider=this.provider,t.constraint=this.constraint,t.onActivation=this.onActivation,t.onDeactivation=this.onDeactivation,t.cache=this.cache,t},e}(),j="Cannot apply @injectable decorator multiple times.",O="Metadata key was used more than once in a parameter:",S="NULL argument",E="Key Not Found",A="Ambiguous match found for serviceIdentifier:",T="No matching bindings found for serviceIdentifier:",C="Missing required @injectable annotation in:",I="Missing required @inject or @multiInject annotation in:",M="Circular dependency found:",D="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.",P=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"The number of constructor arguments in the derived class "+e[0]+" must be >= than the number of constructor arguments of its base class."},N=function(e,t){return"@postConstruct error in class "+e+": "+t},L=function(e,t){return"@preDestroy error in class "+e+": "+t},x=function(e,t){return"onDeactivation() error in class "+e+": "+t},F="Maximum call stack size exceeded",H=function(){function e(){}return e.prototype.getConstructorMetadata=function(e){return{compilerGeneratedMetadata:Reflect.getMetadata(d,e),userGeneratedMetadata:Reflect.getMetadata(l,e)||{}}},e.prototype.getPropertiesMetadata=function(e){return Reflect.getMetadata(f,e)||[]},e}(),B={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};function k(e){return e instanceof RangeError||e.message===F}function V(e){return"function"==typeof e?e.name:"symbol"==typeof e?e.toString():e}function U(e,t,n){var r="",i=n(e,t);return 0!==i.length&&(r="\nRegistered bindings:",i.forEach((function(e){var t="Object";null!==e.implementationType&&(t=W(e.implementationType)),r=r+"\n "+t,e.constraint.metaData&&(r=r+" - "+e.constraint.metaData)}))),r}function q(e,t){return null!==e.parentRequest&&(e.parentRequest.serviceIdentifier===t||q(e.parentRequest,t))}function G(e){e.childRequests.forEach((function(e){if(q(e,e.serviceIdentifier)){var t=function(e){var t=function e(t,n){void 0===n&&(n=[]);var r=V(t.serviceIdentifier);return n.push(r),null!==t.parentRequest?e(t.parentRequest,n):n}(e);return t.reverse().join(" --\x3e ")}(e);throw new Error(M+" "+t)}G(e)}))}function W(e){if(e.name)return e.name;var t=e.toString(),n=t.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+t}var K=function(){function e(e){this.id=w(),this.container=e}return e.prototype.addPlan=function(e){this.plan=e},e.prototype.setCurrentRequest=function(e){this.currentRequest=e},e}(),$=function(){function e(e,t){this.key=e,this.value=t}return e.prototype.toString=function(){return this.key===i?"named: "+String(this.value).toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+String(this.value)+" }"},e}(),Y=function(e,t){this.parentContext=e,this.rootRequest=t},z=function(){function e(e){this._cb=e}return e.prototype.unwrap=function(){return this._cb()},e}(),J=function(){function e(e){this.str=e}return e.prototype.startsWith=function(e){return 0===this.str.indexOf(e)},e.prototype.endsWith=function(e){var t,n=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},e.prototype.contains=function(e){return-1!==this.str.indexOf(e)},e.prototype.equals=function(e){return this.str===e},e.prototype.value=function(){return this.str},e}(),Z=function(){function e(e,t,n,r){this.id=w(),this.type=e,this.serviceIdentifier=n;var o="symbol"==typeof t?t.toString().slice(7,-1):t;this.name=new J(o||""),this.identifier=t,this.metadata=new Array;var a=null;"string"==typeof r?a=new $(i,r):r instanceof $&&(a=r),null!==a&&this.metadata.push(a)}return e.prototype.hasTag=function(e){for(var t=0,n=this.metadata;t<n.length;t++){if(n[t].key===e)return!0}return!1},e.prototype.isArray=function(){return this.hasTag(u)},e.prototype.matchesArray=function(e){return this.matchesTag(u)(e)},e.prototype.isNamed=function(){return this.hasTag(i)},e.prototype.isTagged=function(){return this.metadata.some((function(e){return g.every((function(t){return e.key!==t}))}))},e.prototype.isOptional=function(){return this.matchesTag(c)(!0)},e.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter((function(e){return e.key===i}))[0]:null},e.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter((function(e){return g.every((function(t){return e.key!==t}))})):null},e.prototype.matchesNamedTag=function(e){return this.matchesTag(i)(e)},e.prototype.matchesTag=function(e){var t=this;return function(n){for(var r=0,i=t.metadata;r<i.length;r++){var o=i[r];if(o.key===e&&o.value===n)return!0}return!1}},e}(),X=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};function Q(e,t,n,r){var i=e.getConstructorMetadata(n),o=i.compilerGeneratedMetadata;if(void 0===o)throw new Error(C+" "+t+".");var a=i.userGeneratedMetadata,c=Object.keys(a),s=0===n.length&&c.length>0,u=c.length>n.length,l=function(e,t,n,r,i){for(var o=[],a=0;a<i;a++){var c=ee(a,e,t,n,r);null!==c&&o.push(c)}return o}(r,t,o,a,s||u?c.length:n.length),f=ne(e,n,t);return X(X([],l,!0),f,!0)}function ee(e,t,n,r,i){var o=i[e.toString()]||[],a=ie(o),c=!0!==a.unmanaged,s=r[e],u=a.inject||a.multiInject;if((s=u||s)instanceof z&&(s=s.unwrap()),c){if(!t&&(s===Object||s===Function||void 0===s))throw new Error(I+" argument "+e+" in class "+n+".");var l=new Z(b.ConstructorArgument,a.targetName,s);return l.metadata=o,l}return null}function te(e,t,n,r){var i=e||t;if(void 0===i){var o=C+" for property "+String(n)+" in class "+r+".";throw new Error(o)}return i}function ne(e,t,n){for(var r=e.getPropertiesMetadata(t),i=[],o=Object.getOwnPropertySymbols(r),a=0,c=Object.keys(r).concat(o);a<c.length;a++){var s=c[a],u=r[s],l=ie(u),f=l.targetName||s,d=te(l.inject,l.multiInject,s,n),p=new Z(b.ClassProperty,f,d);p.metadata=u,i.push(p)}var h=Object.getPrototypeOf(t.prototype).constructor;if(h!==Object){var y=ne(e,h,n);i=X(X([],i,!0),y,!0)}return i}function re(e,t){var n=Object.getPrototypeOf(t.prototype).constructor;if(n!==Object){var r=Q(e,W(n),n,!0),i=r.map((function(e){return e.metadata.filter((function(e){return e.key===a}))})),o=[].concat.apply([],i).length,c=r.length-o;return c>0?c:re(e,n)}return 0}function ie(e){var t={};return e.forEach((function(e){t[e.key.toString()]=e.value})),{inject:t[s],multiInject:t[u],targetName:t[o],unmanaged:t[a]}}var oe=function(){function e(e,t,n,r,i){this.id=w(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=n,this.target=i,this.childRequests=[],this.bindings=Array.isArray(r)?r:[r],this.requestScope=null===n?new Map:null}return e.prototype.addChildRequest=function(t,n,r){var i=new e(t,this.parentContext,this,n,r);return this.childRequests.push(i),i},e}();function ae(e){return e._bindingDictionary}function ce(e,t,n,r,i){var o=ue(n.container,i.serviceIdentifier),a=[];return o.length===B.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"==typeof i.serviceIdentifier&&e.getConstructorMetadata(i.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(i.serviceIdentifier).toSelf(),o=ue(n.container,i.serviceIdentifier)),a=t?o:o.filter((function(e){var t=new oe(e.serviceIdentifier,n,r,e,i);return e.constraint(t)})),function(e,t,n,r){switch(t.length){case B.NoBindingsAvailable:if(n.isOptional())return t;var i=V(e),o=T;throw o+=function(e,t){if(t.isTagged()||t.isNamed()){var n="",r=t.getNamedTag(),i=t.getCustomTags();return null!==r&&(n+=r.toString()+"\n"),null!==i&&i.forEach((function(e){n+=e.toString()+"\n"}))," "+e+"\n "+e+" - "+n}return" "+e}(i,n),o+=U(r,i,ue),new Error(o);case B.OnlyOneBindingAvailable:return t;case B.MultipleBindingsAvailable:default:if(n.isArray())return t;i=V(e),o=A+" "+i;throw o+=U(r,i,ue),new Error(o)}}(i.serviceIdentifier,a,i,n.container),a}function se(e,t,n,r,i,o){var a,c;if(null===i){a=ce(e,t,r,null,o),c=new oe(n,r,null,a,o);var s=new Y(r,c);r.addPlan(s)}else a=ce(e,t,r,i,o),c=i.addChildRequest(o.serviceIdentifier,a,o);a.forEach((function(t){var n=null;if(o.isArray())n=c.addChildRequest(t.serviceIdentifier,t,o);else{if(t.cache)return;n=c}if(t.type===m.Instance&&null!==t.implementationType){var i=function(e,t){return Q(e,W(t),t,!1)}(e,t.implementationType);if(!r.container.options.skipBaseClassChecks){var a=re(e,t.implementationType);if(i.length<a){var s=P(W(t.implementationType));throw new Error(s)}}i.forEach((function(t){se(e,!1,t.serviceIdentifier,r,n,t)}))}}))}function ue(e,t){var n=[],r=ae(e);return r.hasKey(t)?n=r.get(t):null!==e.parent&&(n=ue(e.parent,t)),n}function le(e,t,n,r,i,o,a,c){void 0===c&&(c=!1);var l=new K(t),f=function(e,t,n,r,i,o){var a=new $(e?u:s,n),c=new Z(t,r,n,a);if(void 0!==i){var l=new $(i,o);c.metadata.push(l)}return c}(n,r,i,"",o,a);try{return se(e,c,i,l,null,f),l}catch(e){throw k(e)&&G(l.plan.rootRequest),e}}function fe(e){return("object"==typeof e&&null!==e||"function"==typeof e)&&"function"==typeof e.then}function de(e){return!!fe(e)||Array.isArray(e)&&e.some(fe)}var pe,he=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},ye=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},ge=function(e,t,n){e.has(t.id)||e.set(t.id,n)},ve=function(e,t){e.cache=t,e.activated=!0,fe(t)&&me(e,t)},me=function(e,t){return he(void 0,void 0,void 0,(function(){var n,r;return ye(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,t];case 1:return n=i.sent(),e.cache=n,[3,3];case 2:throw r=i.sent(),e.cache=null,e.activated=!1,r;case 3:return[2]}}))}))};!function(e){e.DynamicValue="toDynamicValue",e.Factory="toFactory",e.Provider="toProvider"}(pe||(pe={}));var be=function(e){return function(t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n.forEach((function(n){return e.bind(n).toService(t)}))}}},_e=function(){return _e=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},_e.apply(this,arguments)},we=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Re=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},je=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};function Oe(e,t,n){var r;if(t.length>0){var i=function(e,t){return e.reduce((function(e,n){var r=t(n);return n.target.type===b.ConstructorArgument?e.constructorInjections.push(r):(e.propertyRequests.push(n),e.propertyInjections.push(r)),e.isAsync||(e.isAsync=de(r)),e}),{constructorInjections:[],propertyInjections:[],propertyRequests:[],isAsync:!1})}(t,n),o=_e(_e({},i),{constr:e});r=i.isAsync?function(e){return we(this,void 0,void 0,(function(){var t,n;return Re(this,(function(r){switch(r.label){case 0:return[4,Ee(e.constructorInjections)];case 1:return t=r.sent(),[4,Ee(e.propertyInjections)];case 2:return n=r.sent(),[2,Se(_e(_e({},e),{constructorInjections:t,propertyInjections:n}))]}}))}))}(o):Se(o)}else r=new e;return r}function Se(e){var t,n=new((t=e.constr).bind.apply(t,je([void 0],e.constructorInjections,!1)));return e.propertyRequests.forEach((function(t,r){var i=t.target.identifier,o=e.propertyInjections[r];t.target.isOptional()&&void 0===o||(n[i]=o)})),n}function Ee(e){return we(this,void 0,void 0,(function(){var t,n,r,i;return Re(this,(function(o){for(t=[],n=0,r=e;n<r.length;n++)i=r[n],Array.isArray(i)?t.push(Promise.all(i)):t.push(i);return[2,Promise.all(t)]}))}))}function Ae(e,t){var n=function(e,t){var n,r;if(Reflect.hasMetadata(h,e)){var i=Reflect.getMetadata(h,e);try{return null===(r=(n=t)[i.value])||void 0===r?void 0:r.call(n)}catch(t){if(t instanceof Error)throw new Error(N(e.name,t.message))}}}(e,t);return fe(n)?n.then((function(){return t})):t}function Te(e,t){e.scope!==v.Singleton&&function(e,t){var n="Class cannot be instantiated in "+(e.scope===v.Request?"request":"transient")+" scope.";if("function"==typeof e.onDeactivation)throw new Error(x(t.name,n));if(Reflect.hasMetadata(y,t))throw new Error(L(t.name,n))}(e,t)}var Ce=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Ie=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Me=function(e){return function(t){t.parentContext.setCurrentRequest(t);var n=t.bindings,r=t.childRequests,i=t.target&&t.target.isArray(),o=!(t.parentRequest&&t.parentRequest.target&&t.target&&t.parentRequest.target.matchesArray(t.target.serviceIdentifier));if(i&&o)return r.map((function(t){return Me(e)(t)}));if(!t.target.isOptional()||0!==n.length){var a=n[0];return Le(e,t,a)}}},De=function(e,t){var n=function(e){switch(e.type){case m.Factory:return{factory:e.factory,factoryType:pe.Factory};case m.Provider:return{factory:e.provider,factoryType:pe.Provider};case m.DynamicValue:return{factory:e.dynamicValue,factoryType:pe.DynamicValue};default:throw new Error("Unexpected factory type "+e.type)}}(e);return function(e,t){try{return e()}catch(e){throw k(e)&&(e=t()),e}}((function(){return n.factory.bind(e)(t)}),(function(){return new Error((e=n.factoryType,r=t.currentRequest.serviceIdentifier.toString(),"It looks like there is a circular dependency in one of the '"+e+"' bindings. Please investigate bindings with service identifier '"+r+"'."));var e,r}))},Pe=function(e,t,n){var r,i=t.childRequests;switch(function(e){var t=null;switch(e.type){case m.ConstantValue:case m.Function:t=e.cache;break;case m.Constructor:case m.Instance:t=e.implementationType;break;case m.DynamicValue:t=e.dynamicValue;break;case m.Provider:t=e.provider;break;case m.Factory:t=e.factory}if(null===t){var n=V(e.serviceIdentifier);throw new Error("Invalid binding type: "+n)}}(n),n.type){case m.ConstantValue:case m.Function:r=n.cache;break;case m.Constructor:r=n.implementationType;break;case m.Instance:r=function(e,t,n,r){Te(e,t);var i=Oe(t,n,r);return fe(i)?i.then((function(e){return Ae(t,e)})):Ae(t,i)}(n,n.implementationType,i,Me(e));break;default:r=De(n,t.parentContext)}return r},Ne=function(e,t,n){var r=function(e,t){return t.scope===v.Singleton&&t.activated?t.cache:t.scope===v.Request&&e.has(t.id)?e.get(t.id):null}(e,t);return null!==r||function(e,t,n){t.scope===v.Singleton&&ve(t,n),t.scope===v.Request&&ge(e,t,n)}(e,t,r=n()),r},Le=function(e,t,n){return Ne(e,n,(function(){var r=Pe(e,t,n);return r=fe(r)?r.then((function(e){return xe(t,n,e)})):xe(t,n,r)}))};function xe(e,t,n){var r,i=Fe(e.parentContext,t,n),o=Ve(e.parentContext.container),a=o.next();do{r=a.value;var c=e.parentContext,s=e.serviceIdentifier,u=ke(r,s);i=fe(i)?Be(u,c,i):He(u,c,i),a=o.next()}while(!0!==a.done&&!ae(r).hasKey(e.serviceIdentifier));return i}var Fe=function(e,t,n){return"function"==typeof t.onActivation?t.onActivation(e,n):n},He=function(e,t,n){for(var r=e.next();!r.done;){if(fe(n=r.value(t,n)))return Be(e,t,n);r=e.next()}return n},Be=function(e,t,n){return Ce(void 0,void 0,void 0,(function(){var r,i;return Ie(this,(function(o){switch(o.label){case 0:return[4,n];case 1:r=o.sent(),i=e.next(),o.label=2;case 2:return i.done?[3,4]:[4,i.value(t,r)];case 3:return r=o.sent(),i=e.next(),[3,2];case 4:return[2,r]}}))}))},ke=function(e,t){var n=e._activations;return n.hasKey(t)?n.get(t).values():[].values()},Ve=function(e){for(var t=[e],n=e.parent;null!==n;)t.push(n),n=n.parent;return{next:function(){var e=t.pop();return void 0!==e?{done:!1,value:e}:{done:!0,value:void 0}}}};var Ue=function(e,t){var n=e.parentRequest;return null!==n&&(!!t(n)||Ue(n,t))},qe=function(e){return function(t){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(e)(t)};return n.metaData=new $(e,t),n}},Ge=qe(i),We=function(e){return function(t){var n=null;if(null!==t){if(n=t.bindings[0],"string"==typeof e)return n.serviceIdentifier===e;var r=t.bindings[0].implementationType;return e===r}return!1}},Ke=function(){function e(e){this._binding=e}return e.prototype.when=function(e){return this._binding.constraint=e,new $e(this._binding)},e.prototype.whenTargetNamed=function(e){return this._binding.constraint=Ge(e),new $e(this._binding)},e.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){return null!==e&&(null!==e.target&&!e.target.isNamed()&&!e.target.isTagged())},new $e(this._binding)},e.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=qe(e)(t),new $e(this._binding)},e.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return null!==t&&We(e)(t.parentRequest)},new $e(this._binding)},e.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return null!==t&&Ge(e)(t.parentRequest)},new $e(this._binding)},e.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(n){return null!==n&&qe(e)(t)(n.parentRequest)},new $e(this._binding)},e.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return null!==t&&Ue(t,We(e))},new $e(this._binding)},e.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return null!==t&&!Ue(t,We(e))},new $e(this._binding)},e.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return null!==t&&Ue(t,Ge(e))},new $e(this._binding)},e.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return null!==t&&!Ue(t,Ge(e))},new $e(this._binding)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(n){return null!==n&&Ue(n,qe(e)(t))},new $e(this._binding)},e.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(n){return null!==n&&!Ue(n,qe(e)(t))},new $e(this._binding)},e.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return null!==t&&Ue(t,e)},new $e(this._binding)},e.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return null!==t&&!Ue(t,e)},new $e(this._binding)},e}(),$e=function(){function e(e){this._binding=e}return e.prototype.onActivation=function(e){return this._binding.onActivation=e,new Ke(this._binding)},e.prototype.onDeactivation=function(e){return this._binding.onDeactivation=e,new Ke(this._binding)},e}(),Ye=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new Ke(this._binding),this._bindingOnSyntax=new $e(this._binding)}return e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e.prototype.onDeactivation=function(e){return this._bindingOnSyntax.onDeactivation(e)},e}(),ze=function(){function e(e){this._binding=e}return e.prototype.inRequestScope=function(){return this._binding.scope=v.Request,new Ye(this._binding)},e.prototype.inSingletonScope=function(){return this._binding.scope=v.Singleton,new Ye(this._binding)},e.prototype.inTransientScope=function(){return this._binding.scope=v.Transient,new Ye(this._binding)},e}(),Je=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new Ke(this._binding),this._bindingOnSyntax=new $e(this._binding),this._bindingInSyntax=new ze(e)}return e.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},e.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},e.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e.prototype.onDeactivation=function(e){return this._bindingOnSyntax.onDeactivation(e)},e}(),Ze=function(){function e(e){this._binding=e}return e.prototype.to=function(e){return this._binding.type=m.Instance,this._binding.implementationType=e,new Je(this._binding)},e.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw new Error("The toSelf function can only be applied when a constructor is used as service identifier");var e=this._binding.serviceIdentifier;return this.to(e)},e.prototype.toConstantValue=function(e){return this._binding.type=m.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=v.Singleton,new Ye(this._binding)},e.prototype.toDynamicValue=function(e){return this._binding.type=m.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new Je(this._binding)},e.prototype.toConstructor=function(e){return this._binding.type=m.Constructor,this._binding.implementationType=e,this._binding.scope=v.Singleton,new Ye(this._binding)},e.prototype.toFactory=function(e){return this._binding.type=m.Factory,this._binding.factory=e,this._binding.scope=v.Singleton,new Ye(this._binding)},e.prototype.toFunction=function(e){if("function"!=typeof e)throw new Error("Value provided to function binding must be a function!");var t=this.toConstantValue(e);return this._binding.type=m.Function,this._binding.scope=v.Singleton,t},e.prototype.toAutoFactory=function(e){return this._binding.type=m.Factory,this._binding.factory=function(t){return function(){return t.container.get(e)}},this._binding.scope=v.Singleton,new Ye(this._binding)},e.prototype.toAutoNamedFactory=function(e){return this._binding.type=m.Factory,this._binding.factory=function(t){return function(n){return t.container.getNamed(e,n)}},new Ye(this._binding)},e.prototype.toProvider=function(e){return this._binding.type=m.Provider,this._binding.provider=e,this._binding.scope=v.Singleton,new Ye(this._binding)},e.prototype.toService=function(e){this.toDynamicValue((function(t){return t.container.get(e)}))},e}(),Xe=function(){function e(){}return e.of=function(t,n,r,i,o){var a=new e;return a.bindings=t,a.middleware=n,a.deactivations=i,a.activations=r,a.moduleActivationStore=o,a},e}();var Qe=function(){function e(){this._map=new Map}return e.prototype.getMap=function(){return this._map},e.prototype.add=function(e,t){if(null==e)throw new Error(S);if(null==t)throw new Error(S);var n=this._map.get(e);void 0!==n?n.push(t):this._map.set(e,[t])},e.prototype.get=function(e){if(null==e)throw new Error(S);var t=this._map.get(e);if(void 0!==t)return t;throw new Error(E)},e.prototype.remove=function(e){if(null==e)throw new Error(S);if(!this._map.delete(e))throw new Error(E)},e.prototype.removeIntersection=function(e){var t=this;this.traverse((function(n,r){var i=e.hasKey(n)?e.get(n):void 0;if(void 0!==i){var o=r.filter((function(e){return!i.some((function(t){return e===t}))}));t._setValue(n,o)}}))},e.prototype.removeByCondition=function(e){var t=this,n=[];return this._map.forEach((function(r,i){for(var o=[],a=0,c=r;a<c.length;a++){var s=c[a];e(s)?n.push(s):o.push(s)}t._setValue(i,o)})),n},e.prototype.hasKey=function(e){if(null==e)throw new Error(S);return this._map.has(e)},e.prototype.clone=function(){var t=new e;return this._map.forEach((function(e,n){e.forEach((function(e){return t.add(n,"object"==typeof(r=e)&&null!==r&&"clone"in r&&"function"==typeof r.clone?e.clone():e);var r}))})),t},e.prototype.traverse=function(e){this._map.forEach((function(t,n){e(n,t)}))},e.prototype._setValue=function(e,t){t.length>0?this._map.set(e,t):this._map.delete(e)},e}(),et=function(){function e(){this._map=new Map}return e.prototype.remove=function(e){if(this._map.has(e)){var t=this._map.get(e);return this._map.delete(e),t}return this._getEmptyHandlersStore()},e.prototype.addDeactivation=function(e,t,n){this._getModuleActivationHandlers(e).onDeactivations.add(t,n)},e.prototype.addActivation=function(e,t,n){this._getModuleActivationHandlers(e).onActivations.add(t,n)},e.prototype.clone=function(){var t=new e;return this._map.forEach((function(e,n){t._map.set(n,{onActivations:e.onActivations.clone(),onDeactivations:e.onDeactivations.clone()})})),t},e.prototype._getModuleActivationHandlers=function(e){var t=this._map.get(e);return void 0===t&&(t=this._getEmptyHandlersStore(),this._map.set(e,t)),t},e.prototype._getEmptyHandlersStore=function(){return{onActivations:new Qe,onDeactivations:new Qe}},e}(),tt=function(){return tt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},tt.apply(this,arguments)},nt=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},rt=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},it=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},ot=function(){function e(e){var t=e||{};if("object"!=typeof t)throw new Error("Invalid Container constructor argument. Container options must be an object.");if(void 0===t.defaultScope)t.defaultScope=v.Transient;else if(t.defaultScope!==v.Singleton&&t.defaultScope!==v.Transient&&t.defaultScope!==v.Request)throw new Error('Invalid Container option. Default scope must be a string ("singleton" or "transient").');if(void 0===t.autoBindInjectable)t.autoBindInjectable=!1;else if("boolean"!=typeof t.autoBindInjectable)throw new Error("Invalid Container option. Auto bind injectable must be a boolean");if(void 0===t.skipBaseClassChecks)t.skipBaseClassChecks=!1;else if("boolean"!=typeof t.skipBaseClassChecks)throw new Error("Invalid Container option. Skip base check must be a boolean");this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=w(),this._bindingDictionary=new Qe,this._snapshots=[],this._middleware=null,this._activations=new Qe,this._deactivations=new Qe,this.parent=null,this._metadataReader=new H,this._moduleActivationStore=new et}return e.merge=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var o=new e,a=it([t,n],r,!0).map((function(e){return ae(e)})),c=ae(o);return a.forEach((function(e){var t;t=c,e.traverse((function(e,n){n.forEach((function(e){t.add(e.serviceIdentifier,e.clone())}))}))})),o},e.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),r=0,i=e;r<i.length;r++){var o=i[r],a=n(o.id);o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction,a.unbindAsyncFunction,a.onActivationFunction,a.onDeactivationFunction)}},e.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return nt(this,void 0,void 0,(function(){var t,n,r,i,o;return rt(this,(function(a){switch(a.label){case 0:t=this._getContainerModuleHelpersFactory(),n=0,r=e,a.label=1;case 1:return n<r.length?(i=r[n],o=t(i.id),[4,i.registry(o.bindFunction,o.unbindFunction,o.isboundFunction,o.rebindFunction,o.unbindAsyncFunction,o.onActivationFunction,o.onDeactivationFunction)]):[3,4];case 2:a.sent(),a.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.unload=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.forEach((function(t){var n=e._removeModuleBindings(t.id);e._deactivateSingletons(n),e._removeModuleHandlers(t.id)}))},e.prototype.unloadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return nt(this,void 0,void 0,(function(){var t,n,r,i;return rt(this,(function(o){switch(o.label){case 0:t=0,n=e,o.label=1;case 1:return t<n.length?(r=n[t],i=this._removeModuleBindings(r.id),[4,this._deactivateSingletonsAsync(i)]):[3,4];case 2:o.sent(),this._removeModuleHandlers(r.id),o.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))},e.prototype.bind=function(e){var t=this.options.defaultScope||v.Transient,n=new R(e,t);return this._bindingDictionary.add(e,n),new Ze(n)},e.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},e.prototype.rebindAsync=function(e){return nt(this,void 0,void 0,(function(){return rt(this,(function(t){switch(t.label){case 0:return[4,this.unbindAsync(e)];case 1:return t.sent(),[2,this.bind(e)]}}))}))},e.prototype.unbind=function(e){if(this._bindingDictionary.hasKey(e)){var t=this._bindingDictionary.get(e);this._deactivateSingletons(t)}this._removeServiceFromDictionary(e)},e.prototype.unbindAsync=function(e){return nt(this,void 0,void 0,(function(){var t;return rt(this,(function(n){switch(n.label){case 0:return this._bindingDictionary.hasKey(e)?(t=this._bindingDictionary.get(e),[4,this._deactivateSingletonsAsync(t)]):[3,2];case 1:n.sent(),n.label=2;case 2:return this._removeServiceFromDictionary(e),[2]}}))}))},e.prototype.unbindAll=function(){var e=this;this._bindingDictionary.traverse((function(t,n){e._deactivateSingletons(n)})),this._bindingDictionary=new Qe},e.prototype.unbindAllAsync=function(){return nt(this,void 0,void 0,(function(){var e,t=this;return rt(this,(function(n){switch(n.label){case 0:return e=[],this._bindingDictionary.traverse((function(n,r){e.push(t._deactivateSingletonsAsync(r))})),[4,Promise.all(e)];case 1:return n.sent(),this._bindingDictionary=new Qe,[2]}}))}))},e.prototype.onActivation=function(e,t){this._activations.add(e,t)},e.prototype.onDeactivation=function(e,t){this._deactivations.add(e,t)},e.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},e.prototype.isCurrentBound=function(e){return this._bindingDictionary.hasKey(e)},e.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,i,t)},e.prototype.isBoundTagged=function(e,t,n){var r=!1;if(this._bindingDictionary.hasKey(e)){var i=this._bindingDictionary.get(e),o=function(e,t,n,r){var i=new Z(b.Variable,"",t,new $(n,r)),o=new K(e);return new oe(t,o,null,[],i)}(this,e,t,n);r=i.some((function(e){return e.constraint(o)}))}return!r&&this.parent&&(r=this.parent.isBoundTagged(e,t,n)),r},e.prototype.snapshot=function(){this._snapshots.push(Xe.of(this._bindingDictionary.clone(),this._middleware,this._activations.clone(),this._deactivations.clone(),this._moduleActivationStore.clone()))},e.prototype.restore=function(){var e=this._snapshots.pop();if(void 0===e)throw new Error("No snapshot available to restore.");this._bindingDictionary=e.bindings,this._activations=e.activations,this._deactivations=e.deactivations,this._middleware=e.middleware,this._moduleActivationStore=e.moduleActivationStore},e.prototype.createChild=function(t){var n=new e(t||this.options);return n.parent=this,n},e.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce((function(e,t){return t(e)}),n)},e.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},e.prototype.get=function(e){var t=this._getNotAllArgs(e,!1);return this._getButThrowIfAsync(t)},e.prototype.getAsync=function(e){return nt(this,void 0,void 0,(function(){var t;return rt(this,(function(n){return t=this._getNotAllArgs(e,!1),[2,this._get(t)]}))}))},e.prototype.getTagged=function(e,t,n){var r=this._getNotAllArgs(e,!1,t,n);return this._getButThrowIfAsync(r)},e.prototype.getTaggedAsync=function(e,t,n){return nt(this,void 0,void 0,(function(){var r;return rt(this,(function(i){return r=this._getNotAllArgs(e,!1,t,n),[2,this._get(r)]}))}))},e.prototype.getNamed=function(e,t){return this.getTagged(e,i,t)},e.prototype.getNamedAsync=function(e,t){return this.getTaggedAsync(e,i,t)},e.prototype.getAll=function(e){var t=this._getAllArgs(e);return this._getButThrowIfAsync(t)},e.prototype.getAllAsync=function(e){var t=this._getAllArgs(e);return this._getAll(t)},e.prototype.getAllTagged=function(e,t,n){var r=this._getNotAllArgs(e,!0,t,n);return this._getButThrowIfAsync(r)},e.prototype.getAllTaggedAsync=function(e,t,n){var r=this._getNotAllArgs(e,!0,t,n);return this._getAll(r)},e.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,i,t)},e.prototype.getAllNamedAsync=function(e,t){return this.getAllTaggedAsync(e,i,t)},e.prototype.resolve=function(e){var t=this.isBound(e);t||this.bind(e).toSelf();var n=this.get(e);return t||this.unbind(e),n},e.prototype._preDestroy=function(e,t){var n,r;if(Reflect.hasMetadata(y,e))return null===(r=(n=t)[Reflect.getMetadata(y,e).value])||void 0===r?void 0:r.call(n)},e.prototype._removeModuleHandlers=function(e){var t=this._moduleActivationStore.remove(e);this._activations.removeIntersection(t.onActivations),this._deactivations.removeIntersection(t.onDeactivations)},e.prototype._removeModuleBindings=function(e){return this._bindingDictionary.removeByCondition((function(t){return t.moduleId===e}))},e.prototype._deactivate=function(e,t){var n=this,r=Object.getPrototypeOf(t).constructor;try{if(this._deactivations.hasKey(e.serviceIdentifier)){var i=this._deactivateContainer(t,this._deactivations.get(e.serviceIdentifier).values());if(fe(i))return this._handleDeactivationError(i.then((function(){return n._propagateContainerDeactivationThenBindingAndPreDestroyAsync(e,t,r)})),r)}var o=this._propagateContainerDeactivationThenBindingAndPreDestroy(e,t,r);if(fe(o))return this._handleDeactivationError(o,r)}catch(e){if(e instanceof Error)throw new Error(x(r.name,e.message))}},e.prototype._handleDeactivationError=function(e,t){return nt(this,void 0,void 0,(function(){var n;return rt(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e];case 1:return r.sent(),[3,3];case 2:if((n=r.sent())instanceof Error)throw new Error(x(t.name,n.message));return[3,3];case 3:return[2]}}))}))},e.prototype._deactivateContainer=function(e,t){for(var n=this,r=t.next();r.value;){var i=r.value(e);if(fe(i))return i.then((function(){return n._deactivateContainerAsync(e,t)}));r=t.next()}},e.prototype._deactivateContainerAsync=function(e,t){return nt(this,void 0,void 0,(function(){var n;return rt(this,(function(r){switch(r.label){case 0:n=t.next(),r.label=1;case 1:return n.value?[4,n.value(e)]:[3,3];case 2:return r.sent(),n=t.next(),[3,1];case 3:return[2]}}))}))},e.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(e,t){e._binding.moduleId=t},n=function(n){return function(r){var i=e.rebind(r);return t(i,n),i}},r=function(t){return function(n,r){e._moduleActivationStore.addActivation(t,n,r),e.onActivation(n,r)}},i=function(t){return function(n,r){e._moduleActivationStore.addDeactivation(t,n,r),e.onDeactivation(n,r)}};return function(o){return{bindFunction:(a=o,function(n){var r=e.bind(n);return t(r,a),r}),isboundFunction:function(t){return e.isBound(t)},onActivationFunction:r(o),onDeactivationFunction:i(o),rebindFunction:n(o),unbindFunction:function(t){return e.unbind(t)},unbindAsyncFunction:function(t){return e.unbindAsync(t)}};var a}},e.prototype._getAll=function(e){return Promise.all(this._get(e))},e.prototype._get=function(e){var t=tt(tt({},e),{contextInterceptor:function(e){return e},targetType:b.Variable});if(this._middleware){var n=this._middleware(t);if(null==n)throw new Error("Invalid return type in middleware. Middleware must return!");return n}return this._planAndResolve()(t)},e.prototype._getButThrowIfAsync=function(e){var t=this._get(e);if(de(t))throw new Error("You are attempting to construct '"+e.serviceIdentifier+"' in a synchronous way\n but it has asynchronous dependencies.");return t},e.prototype._getAllArgs=function(e){return{avoidConstraints:!0,isMultiInject:!0,serviceIdentifier:e}},e.prototype._getNotAllArgs=function(e,t,n,r){return{avoidConstraints:!1,isMultiInject:t,serviceIdentifier:e,key:n,value:r}},e.prototype._planAndResolve=function(){var e=this;return function(t){var n=le(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);return function(e){return Me(e.plan.rootRequest.requestScope)(e.plan.rootRequest)}(n=t.contextInterceptor(n))}},e.prototype._deactivateIfSingleton=function(e){var t=this;if(e.activated)return fe(e.cache)?e.cache.then((function(n){return t._deactivate(e,n)})):this._deactivate(e,e.cache)},e.prototype._deactivateSingletons=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if(fe(this._deactivateIfSingleton(r)))throw new Error("Attempting to unbind dependency with asynchronous destruction (@preDestroy or onDeactivation)")}},e.prototype._deactivateSingletonsAsync=function(e){return nt(this,void 0,void 0,(function(){var t=this;return rt(this,(function(n){switch(n.label){case 0:return[4,Promise.all(e.map((function(e){return t._deactivateIfSingleton(e)})))];case 1:return n.sent(),[2]}}))}))},e.prototype._propagateContainerDeactivationThenBindingAndPreDestroy=function(e,t,n){return this.parent?this._deactivate.bind(this.parent)(e,t):this._bindingDeactivationAndPreDestroy(e,t,n)},e.prototype._propagateContainerDeactivationThenBindingAndPreDestroyAsync=function(e,t,n){return nt(this,void 0,void 0,(function(){return rt(this,(function(r){switch(r.label){case 0:return this.parent?[4,this._deactivate.bind(this.parent)(e,t)]:[3,2];case 1:return r.sent(),[3,4];case 2:return[4,this._bindingDeactivationAndPreDestroyAsync(e,t,n)];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))},e.prototype._removeServiceFromDictionary=function(e){try{this._bindingDictionary.remove(e)}catch(t){throw new Error("Could not unbind serviceIdentifier: "+V(e))}},e.prototype._bindingDeactivationAndPreDestroy=function(e,t,n){var r=this;if("function"==typeof e.onDeactivation){var i=e.onDeactivation(t);if(fe(i))return i.then((function(){return r._preDestroy(n,t)}))}return this._preDestroy(n,t)},e.prototype._bindingDeactivationAndPreDestroyAsync=function(e,t,n){return nt(this,void 0,void 0,(function(){return rt(this,(function(r){switch(r.label){case 0:return"function"!=typeof e.onDeactivation?[3,2]:[4,e.onDeactivation(t)];case 1:r.sent(),r.label=2;case 2:return[4,this._preDestroy(n,t)];case 3:return r.sent(),[2]}}))}))},e}(),at=function(e){this.id=w(),this.registry=e},ct=function(e){this.id=w(),this.registry=e};function st(e,t,n,r){!function(e){if(void 0!==e)throw new Error(D)}(t),lt(l,e,n.toString(),r)}function ut(e){var t=[];if(Array.isArray(e)){var n=function(e){for(var t=new Set,n=0,r=e;n<r.length;n++){var i=r[n];if(t.has(i))return i;t.add(i)}}((t=e).map((function(e){return e.key})));if(void 0!==n)throw new Error(O+" "+n.toString())}else t=[e];return t}function lt(e,t,n,r){var i=ut(r),o={};Reflect.hasOwnMetadata(e,t)&&(o=Reflect.getMetadata(e,t));var a=o[n];if(void 0===a)a=[];else for(var c=function(e){if(i.some((function(t){return t.key===e.key})))throw new Error(O+" "+e.key.toString())},s=0,u=a;s<u.length;s++){c(u[s])}a.push.apply(a,i),o[n]=a,Reflect.defineMetadata(e,o,t)}function ft(e){return function(t,n,r){"number"==typeof r?st(t,n,r,e):function(e,t,n){if(void 0!==e.prototype)throw new Error(D);lt(f,e.constructor,t,n)}(t,n,e)}}function dt(e,t){Reflect.decorate(e,t)}function pt(e,t){return function(n,r){t(n,r,e)}}function ht(e,t,n){"number"==typeof n?dt([pt(n,e)],t):"string"==typeof n?Reflect.decorate([e],t,n):dt([e],t)}function yt(){return function(e){if(Reflect.hasOwnMetadata(d,e))throw new Error(j);var t=Reflect.getMetadata(p,e)||[];return Reflect.defineMetadata(d,t,e),e}}function gt(e,t){return ft(new $(e,t))}function vt(e){return ft(new $(i,e))}function mt(e){return function(t){return function(n,r,i){if(void 0===t){var o="function"==typeof n?n.name:n.constructor.name;throw new Error("@inject called with undefined this could mean that the class "+o+" has a circular dependency problem. You can use a LazyServiceIdentifier to  overcome this limitation.")}return ft(new $(e,t))(n,r,i)}}}var bt=mt(s);function _t(){return ft(new $(c,!0))}function wt(){return function(e,t,n){st(e,t,n,new $(a,!0))}}var Rt=mt(u);function jt(e){return function(t,n,r){st(t,n,r,new $(o,e))}}function Ot(e,t){return function(){return function(n,r){var i=new $(e,r);if(Reflect.hasOwnMetadata(e,n.constructor))throw new Error(t);Reflect.defineMetadata(e,i,n.constructor)}}}var St,Et=Ot(h,"Cannot apply @postConstruct decorator multiple times in the same class"),At=Ot(y,"Cannot apply @preDestroy decorator multiple times in the same class");St||(St={});var Tt=r},36151:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.requiredFields=void 0;const r=n(98392),i=n(93176);t.requiredFields=function(...e){return function(t,n,o){const a=o.value;o.value=function(t,...n){const o=e.find((e=>!(e in t)));return o?async function*(e){return(0,r.failed)(void 0,`Argument "${e}" is not defined`,i.NativeOperationType.MISSING_ARGUMENT_ERROR)}(o):a.call(this,t,...n)}}}},40233:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Extractor=void 0;const r=n(17329),i=n(99489),o=n(98392),a=n(93176);var c;!function(e){e.noOperations="noOperations",e.noReturn="noReturn",e.failed="failed",e.success="success",e.interrupted="interrupted"}(c||(c={}));t.Extractor=class{constructor(e,t,n,i,o){this.config=e,this.program=t,this.elScope=n,this.varScope=i,this.funcs=o,this.observer=new r.Observer}async run(){const e=(new i.ProgramFactory).create(this.config,this.observer,this.elScope,this.varScope,this.funcs,!0);if(0===this.program.length)return this.response(c.noOperations,{main:e});try{const t=Object.entries((0,o.clone)(this.program));for(const[n,r]of t){const t=await e.handle({operation:r,index:n});if((0,o.isFailed)(t,r))return this.response(c.failed,{main:e,result:t});if(t.return)return this.response(c.success,{result:t})}return this.response(c.noReturn,{main:e})}catch(e){return this.response(c.interrupted,{message:e.message})}}on(e,t){this.observer.subscribe(e,t)}response(e,t){return{[c.noOperations]:({main:e})=>({status:a.ExtractorResponseStatus.FAILED,response:e.getTrace("No operations were provided")}),[c.noReturn]:({main:e})=>({status:a.ExtractorResponseStatus.FAILED,response:e.getTrace('No "return" operation was provided')}),[c.failed]:({main:e,result:t})=>({status:a.ExtractorResponseStatus.FAILED,response:e.getTrace(t.message)}),[c.success]:({result:e})=>({status:a.ExtractorResponseStatus.SUCCESS,response:e.value.value}),[c.interrupted]:({message:e})=>({status:a.ExtractorResponseStatus.INTERRUPTED,response:e})}[e](t)}}},93176:(e,t)=>{"use strict";var n,r,i,o,a,c;Object.defineProperty(t,"__esModule",{value:!0}),t.ExtractorResponseStatus=t.FlowList=t.SINGLE_GET_TYPE=t.NativeOperationType=t.OperationType=t.OperationScope=void 0,function(e){e.LOCAL="LOCAL",e.BLOCK="BLOCK"}(n||(t.OperationScope=n={})),function(e){e.SINGLE="single",e.PLURAL="plural",e.SPLIT_SCOPE="splitScope",e.OR="or",e.AND="and",e.COMPUTED="computed",e.EXIST="exist",e.LOG="log",e.IS_NOT_HIDDEN_ELEMENT="isNotHiddenElement",e.MARK_PROCESSED_ELEMENT="markProcessedElement",e.WAIT_FOR_NOT_PROCESSED_ELEMENT="waitForNotProcessedElement",e.FUNC="func",e.SELECT="select",e.CALL_METHOD="callMethod",e.GET_PROPERTY="property",e.LITERAL="literal",e.VAR="var",e.FOR_EACH="forEach",e.RETURN="return",e.MAP="map",e.CLOSEST="closest",e.PRICE_PARSER="priceParser",e.JSON_PARSER="jsonParser",e.EMIT="emit",e.FLOW="flow",e.CONDITION="condition",e.REPLACE="replace",e.REPLACE_BETWEEN="replaceBetween",e.MATH="math",e.CONSTRUCTOR="constructor",e.INTERRUPT="interrupt"}(r||(t.OperationType=r={})),function(e){e.NATIVE_ERROR="nativeError",e.MISSING_ARGUMENT_ERROR="missingArgumentError"}(i||(t.NativeOperationType=i={})),function(e){e.TEXT="text",e.VALUE="value",e.ATTRIBUTE="attribute"}(o||(t.SINGLE_GET_TYPE=o={})),function(e){e.NONE="none",e.THEN="then",e.ELSE="else"}(a||(t.FlowList=a={})),function(e){e.SUCCESS="SUCCESS",e.FAILED="FAILED",e.INTERRUPTED="INTERRUPTED"}(c||(t.ExtractorResponseStatus=c={}))},40164:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Computed=void 0;const a=n(93176),c=n(60131),s=n(98392),u=n(38400),l=n(68947),f=n(36151);let d=class{constructor(e){this.main=e}type(){return a.OperationType.COMPUTED}scope(){return a.OperationScope.LOCAL}async*handle(e){const t=[];for(const n of e.subjects){const e=await this.main.handle({operation:n,isChild:!0});if(!e.success)return(0,s.failed)(void 0,e.message);t.push(e.value.value)}let n;if(Array.isArray(e.value)){n=[];for(const t of e.value)n.push((await this.main.handle({operation:t,isChild:!0})).value.value)}else n=(await this.main.handle({operation:e.value,isChild:!0})).value.value;const r={var:t.join("."),type:a.OperationType.LITERAL,value:n,accumulate:e.accumulate};return await this.main.handle({operation:r,isChild:!0}),(0,s.succeeded)(n)}};t.Computed=d,r([(0,f.requiredFields)("subjects","value"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],d.prototype,"handle",null),t.Computed=d=r([(0,u.injectable)(),o(0,(0,u.inject)(l.Injections.program)),i("design:paramtypes",[c.Program])],d)},27578:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Closest=void 0;const a=n(93176),c=n(60131),s=n(98392),u=n(38400),l=n(68947),f=n(36151);let d=class{constructor(e){this.main=e}type(){return a.OperationType.CLOSEST}scope(){return a.OperationScope.LOCAL}async*handle(e){const t=await this.main.handle({operation:e.subject,isChild:!0});if(!t.success)return(0,s.failed)(void 0,t.message);const n=t.value.value,r=await this.main.handle({operation:e.selector,isChild:!0});if(!r.success)return(0,s.failed)(void 0,r.message);try{const e=n.closest(r.value.value);return(0,s.succeeded)(e)}catch(e){return(0,s.failed)(void 0,e.message,a.NativeOperationType.NATIVE_ERROR)}}};t.Closest=d,r([(0,f.requiredFields)("subject","selector"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],d.prototype,"handle",null),t.Closest=d=r([(0,u.injectable)(),o(0,(0,u.inject)(l.Injections.program)),i("design:paramtypes",[c.Program])],d)},425:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ExistElement=void 0;const a=n(93176),c=n(98392),s=n(38400),u=n(68947),l=n(36151);let f=class{constructor(e){this.elScope=e}type(){return a.OperationType.EXIST}scope(){return a.OperationScope.LOCAL}async*handle(e){try{for(const t of e.selectors){if(null!=this.elScope.querySelector(t))return(0,c.succeeded)(!0)}}catch(e){return(0,c.failed)(void 0,e.message,a.NativeOperationType.NATIVE_ERROR)}return(0,c.failed)(!1,"No selectors found to exist")}};t.ExistElement=f,r([(0,l.requiredFields)("selectors"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],f.prototype,"handle",null),t.ExistElement=f=r([(0,s.injectable)(),o(0,(0,s.inject)(u.Injections.elScope)),i("design:paramtypes",[Object])],f)},58876:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.IsNotHiddenElement=void 0;const a=n(93176),c=n(98392),s=n(20069),u=n(38400),l=n(68947),f=n(36151);let d=class{constructor(e,t){this.elScope=e,this.logger=t}type(){return a.OperationType.IS_NOT_HIDDEN_ELEMENT}scope(){return a.OperationScope.LOCAL}async*handle(e){for(const t of e.selectors){let e;try{e=this.elScope.querySelector(t)}catch(e){this.logger.error("IsNotHiddenElement:",e);continue}if(null==e)continue;if(!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length))return(0,c.succeeded)(!0)}return(0,c.failed)(!1,"No selectors found to be visible")}};t.IsNotHiddenElement=d,r([(0,f.requiredFields)("selectors"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],d.prototype,"handle",null),t.IsNotHiddenElement=d=r([(0,u.injectable)(),o(0,(0,u.inject)(l.Injections.elScope)),o(1,(0,u.inject)(l.Injections.logger)),i("design:paramtypes",[Object,s.MyLogger])],d)},30819:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Select=void 0;const a=n(93176),c=n(60131),s=n(98392),u=n(38400),l=n(68947),f=n(36151),d=n(71979),p=n(68253);let h=class{constructor(e,t,n,r){this.main=e,this.selectorsSolver=t,this.elementSolver=n,this.elScope=r}type(){return a.OperationType.SELECT}scope(){return a.OperationScope.LOCAL}async*handle(e){let t=this.elScope;if(null!=e.scope){const n=await this.elementSolver.solve(e.scope);if(!n.success)return(0,s.failed)(void 0,n.message);t=n.value.value}const n=Array.isArray(e.selector)?e.selector:[e.selector],r=await this.selectorsSolver.solve(n);if(!r.success)return(0,s.failed)(void 0,r.message);for(const n of r.value.value)try{if(e.plural){const e=t.querySelectorAll(n);if(!e.length)continue;return(0,s.succeeded)([...e])}{const e=t.querySelector(n);if(!e)continue;return(0,s.succeeded)(e)}}catch(e){return(0,s.failed)(void 0,e.message,a.NativeOperationType.NATIVE_ERROR)}return(0,s.succeeded)(e.plural?[]:null)}};t.Select=h,r([(0,f.requiredFields)("selector"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],h.prototype,"handle",null),t.Select=h=r([(0,u.injectable)(),o(0,(0,u.inject)(l.Injections.program)),o(1,(0,u.inject)(l.Injections.selectorsSolver)),o(2,(0,u.inject)(l.Injections.htmlElementSolver)),o(3,(0,u.inject)(l.Injections.elScope)),i("design:paramtypes",[c.Program,d.SelectorsSolver,p.HtmlElementSolver,Object])],h)},64491:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Emit=void 0;const a=n(60131),c=n(17329),s=n(99489),u=n(98392),l=n(93176),f=n(38400),d=n(68947),p=n(36151);let h=class{constructor(e,t,n){this.main=e,this.observer=t,this.factory=n}type(){return l.OperationType.EMIT}scope(){return l.OperationScope.LOCAL}async*handle(e){const t=await this.main.handle({operation:e.event,isChild:!0});if((0,u.isFailed)(t,e.event))return(0,u.failed)(void 0,t.message);if("string"!=typeof t.value.value)return(0,u.failed)(void 0,"Event name was not provided properly. It should be a string",l.NativeOperationType.NATIVE_ERROR);const n=(0,u.succeeded)([]);if(null!=e.args&&Array.isArray(e.args)){const t=this.factory.prototype(this.main);for(const t of e.args){const e=await this.main.handle({operation:t,isChild:!0});if((0,u.isFailed)(e,t))return(0,u.failed)(void 0,e.message);const r=e.value.value,i=(0,u.isObject)(r)?(0,u.clone)(r):r;n.value.value.push(i)}this.main.mergeLocalScope(t.getLocalScope())}return this.observer.emit(t.value.value,n?n.value.value:void 0),(0,u.succeeded)(!0)}};t.Emit=h,r([(0,p.requiredFields)("event"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],h.prototype,"handle",null),t.Emit=h=r([(0,f.injectable)(),o(0,(0,f.inject)(d.Injections.program)),o(1,(0,f.inject)(d.Injections.observer)),o(2,(0,f.inject)(d.Injections.factory)),i("design:paramtypes",[a.Program,c.Observer,s.ProgramFactory])],h)},63778:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Func=void 0;const a=n(93176),c=n(60131),s=n(99489),u=n(98392),l=n(38400),f=n(68947),d=n(36151);let p=class{constructor(e,t,n){this.main=e,this.factory=t,this.funcs=n}type(){return a.OperationType.FUNC}scope(){return a.OperationScope.BLOCK}async*handle(e){const t=await this.main.handle({operation:e.name,isChild:!0});if(!t.success)return(0,u.failed)(void 0,t.message);const n=t.value.value;if("string"!=typeof n||!this.funcs[n])return(0,u.failed)(void 0,`Operation "${n}" can not be found`,a.NativeOperationType.NATIVE_ERROR);const r=this.funcs[n],i={},o=e.args??[];for(let e=0;e<o.length;e++){const t=await this.main.handle({operation:o[e],isChild:!0});if(!t.success)return(0,u.failed)(void 0,t.message);if(r.params[e]){i[r.params[e]]=t.value.value}}const c=this.factory.create(this.main.getConfig(),this.main.getObserver(),this.main.getElScopeRef(),this.main.getGlobalScope(),this.funcs,!1,i);if(c.mergeLocalScope(this.main.getGlobalScope()),0===r.operations.length)return(0,u.failed)(void 0,"Function operation list is empty");for(const[e,t]of Object.entries(r.operations)){const n=await c.handle({operation:t,index:e});if((0,u.isFailed)(n,t))return(0,u.failed)(void 0,n.message);if(t.type===a.OperationType.RETURN)return(0,u.succeeded)(n.value.value)}return(0,u.succeeded)(void 0)}};t.Func=p,r([(0,d.requiredFields)("name"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],p.prototype,"handle",null),t.Func=p=r([(0,l.injectable)(),o(0,(0,l.inject)(f.Injections.program)),o(1,(0,l.inject)(f.Injections.factory)),o(2,(0,l.inject)(f.Injections.funcs)),i("design:paramtypes",[c.Program,s.ProgramFactory,Object])],p)},80031:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Interrupt=void 0;const a=n(93176),c=n(38400),s=n(68947),u=n(20069);let l=class{constructor(e){this.logger=e}type(){return a.OperationType.INTERRUPT}scope(){return a.OperationScope.LOCAL}async*handle({msg:e}){throw e&&this.logger.log(e),new Error(e??"Operations were interrupted")}};t.Interrupt=l,t.Interrupt=l=r([(0,c.injectable)(),o(0,(0,c.inject)(s.Injections.logger)),i("design:paramtypes",[u.MyLogger])],l)},24224:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.Literal=void 0;const o=n(98392),a=n(93176),c=n(38400),s=n(36151);let u=class{type(){return a.OperationType.LITERAL}scope(){return a.OperationScope.LOCAL}async*handle(e){return(0,o.succeeded)(e.value)}};t.Literal=u,r([(0,s.requiredFields)("value"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],u.prototype,"handle",null),t.Literal=u=r([(0,c.injectable)()],u)},69767:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Log=void 0;const a=n(93176),c=n(98392),s=n(38400),u=n(68947),l=n(99664),f=n(36151),d=n(20069),p=n(60131);let h=class{constructor(e,t,n){this.main=e,this.loggerTracer=t,this.logger=n}type(){return a.OperationType.LOG}scope(){return a.OperationScope.LOCAL}async*handle({args:e,msg:t}){const n=this.main.programScope(!1);let r;if(e){const i=Array.isArray(e)?e:[e];r=Object.values(i).reduce(((e,t)=>({...e,[t]:n[t]})),{}),this.loggerTracer.log(t,r)}else this.loggerTracer.log(t);return null!=r?this.logger.log(t,r):this.logger.log(t),(0,c.succeeded)(!0)}};t.Log=h,r([(0,f.requiredFields)("msg"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],h.prototype,"handle",null),t.Log=h=r([(0,s.injectable)(),o(0,(0,s.inject)(u.Injections.program)),o(1,(0,s.inject)(u.Injections.loggerTracer)),o(2,(0,s.inject)(u.Injections.logger)),i("design:paramtypes",[p.Program,l.LoggerTracer,d.MyLogger])],h)},18028:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.And=void 0;const a=n(60131),c=n(99489),s=n(98392),u=n(93176),l=n(38400),f=n(68947),d=n(36151);let p=class{constructor(e,t){this.main=e,this.factory=t}type(){return u.OperationType.AND}scope(){return u.OperationScope.BLOCK}async*handle(e){const t=this.factory.prototype(this.main);for(const[n,r]of Object.entries(e.operations??[])){const e=await t.handle({operation:r,index:n});if((0,s.isFailed)(e,r)||!e.value.value)return(0,s.failed)(!1,e.message)}return this.main.mergeLocalScope(t.getLocalScope()),(0,s.succeeded)(!0)}};t.And=p,r([(0,d.requiredFields)("operations"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],p.prototype,"handle",null),t.And=p=r([(0,l.injectable)(),o(0,(0,l.inject)(f.Injections.program)),o(1,(0,l.inject)(f.Injections.factory)),i("design:paramtypes",[a.Program,c.ProgramFactory])],p)},90010:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Condition=void 0;const a=n(93176),c=n(60131),s=n(99489),u=n(98392),l=n(38400),f=n(68947),d=n(36151);let p=class{constructor(e,t){this.main=e,this.factory=t}type(){return a.OperationType.CONDITION}scope(){return a.OperationScope.LOCAL}async*handle(e){const t=this.factory.prototype(this.main),n=await t.handle({operation:e.left,isChild:!0});if(!n.success)return(0,u.failed)(!1,n.message);const r=await t.handle({operation:e.right,isChild:!0});if(!r.success)return(0,u.failed)(!1,r.message);const i={"!=":()=>n.value.value!=r.value.value,"!==":()=>n.value.value!==r.value.value,">":()=>n.value.value>r.value.value,"<":()=>n.value.value<r.value.value,"<=":()=>n.value.value<=r.value.value,">=":()=>n.value.value>=r.value.value,"==":()=>n.value.value==r.value.value,"===":()=>n.value.value===r.value.value};if(!i[e.operator])return(0,u.failed)(void 0,`Unsupportable condition operator "${e.operator}"`,a.NativeOperationType.NATIVE_ERROR);const o=i[e.operator]();return this.main.mergeLocalScope(t.getLocalScope()),(0,u.succeeded)(o)}};t.Condition=p,r([(0,d.requiredFields)("operator","left","right"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],p.prototype,"handle",null),t.Condition=p=r([(0,l.injectable)(),o(0,(0,l.inject)(f.Injections.program)),o(1,(0,l.inject)(f.Injections.factory)),i("design:paramtypes",[c.Program,s.ProgramFactory])],p)},42205:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Flow=void 0;const a=n(93176),c=n(60131),s=n(99489),u=n(98392),l=n(38400),f=n(68947),d=n(36151);let p=class{constructor(e,t){this.main=e,this.factory=t}type(){return a.OperationType.FLOW}scope(){return a.OperationScope.BLOCK}async*handle(e){const t={condition:!0,flow:{name:a.FlowList.NONE,result:!0}},n=this.factory.prototype(this.main),r=this.factory.prototype(this.main);for(const n of e.condition){const e=await r.handle({operation:n,isChild:!0});if(!e.success||!e.value.value){t.condition=!1;break}}t.condition&&n.mergeLocalScope(r.getLocalScope());const i=t.condition?a.FlowList.THEN:a.FlowList.ELSE;if(i===a.FlowList.ELSE&&void 0===e[i])return(0,u.failed)(t,`condition is "FALSE". "${i}" is not defined`,a.NativeOperationType.NATIVE_ERROR);if(void 0!==e[i]){let r,o;t.flow.name=i;try{r=this.mapFlowBlockToFullFormat(e[i],i),o=this.factory.prototype(n)}catch(e){return(0,u.failed)(void 0,e.message,a.NativeOperationType.NATIVE_ERROR)}yield{condition:t.condition,flow:{result:!0,name:i}};for(const[e,n]of Object.entries(r.operations??[])){let i=!1,a={};if(a=await o.handle({operation:n,index:e}),i=(0,u.isFailed)(a,n),i)return t.flow.result=!1,r.optional?(0,u.succeeded)(t):(0,u.failed)(t,a.message)}n.mergeLocalScope(o.getLocalScope())}return this.main.mergeLocalScope(n.getLocalScope()),(0,u.succeeded)(t)}mapFlowBlockToFullFormat(e,t){if(Array.isArray(e))return{optional:!1,operations:e};if((0,u.isObject)(e))return e;throw new Error(`Could not map a block "${t}", cause it's "${e}"`)}};t.Flow=p,r([(0,d.requiredFields)("condition"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],p.prototype,"handle",null),t.Flow=p=r([(0,l.injectable)(),o(0,(0,l.inject)(f.Injections.program)),o(1,(0,l.inject)(f.Injections.factory)),i("design:paramtypes",[c.Program,s.ProgramFactory])],p)},47607:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Or=void 0;const a=n(60131),c=n(99489),s=n(98392),u=n(93176),l=n(38400),f=n(68947),d=n(36151);let p=class{constructor(e,t){this.main=e,this.factory=t}type(){return u.OperationType.OR}scope(){return u.OperationScope.BLOCK}async*handle(e){for(const[t,n]of Object.entries(e.operations)){const e=this.factory.prototype(this.main),r=await e.handle({operation:n,index:t});if(r.success&&r.value.value)return this.main.mergeLocalScope(e.getLocalScope()),(0,s.succeeded)(!0)}return(0,s.failed)(!1,'All of the "or" operations are falsy')}};t.Or=p,r([(0,d.requiredFields)("operations"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],p.prototype,"handle",null),t.Or=p=r([(0,l.injectable)(),o(0,(0,l.inject)(f.Injections.program)),o(1,(0,l.inject)(f.Injections.factory)),i("design:paramtypes",[a.Program,c.ProgramFactory])],p)},31995:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ForEach=void 0;const a=n(93176),c=n(60131),s=n(99489),u=n(98392),l=n(38400),f=n(68947),d=n(36151),p=n(17329);let h=class{constructor(e,t,n,r,i){this.main=e,this.factory=t,this.observer=n,this.config=r,this.funcs=i}type(){return a.OperationType.FOR_EACH}scope(){return a.OperationScope.BLOCK}async*handle(e){const t=await this.main.handle({operation:e.subject,isChild:!0});if(!t.success)return(0,u.failed)(void 0,t.message);const n=t.value.value;for(let t=0;t<n.length;t++){const r={},i={type:a.OperationType.LITERAL,var:e.index??"$index",value:t},o={type:a.OperationType.LITERAL,var:e.item??"$item",value:n[t]},c=this.factory.create(this.config,this.observer,document,this.main.getGlobalScope(),this.funcs,!1,r);await c.handle({operation:i,isChild:!0}),await c.handle({operation:o,isChild:!0}),c.mergeLocalScope(this.main.programScope(!0));for(const[t,n]of Object.entries(e.forEach)){const e=await c.handle({operation:n,index:t});if((0,u.isFailed)(e,n))return(0,u.failed)(void 0,e.message)}this.clearScope(r,[o,i,...Boolean(e.cleanScope)&&e.forEach||[]]),this.main.mergeLocalScope(c.cloneLocalScope())}return(0,u.succeeded)(!0)}clearScope(e,t){t.forEach((t=>{t.var&&delete e[t.var]}))}};t.ForEach=h,r([(0,d.requiredFields)("subject","forEach"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],h.prototype,"handle",null),t.ForEach=h=r([(0,l.injectable)(),o(0,(0,l.inject)(f.Injections.program)),o(1,(0,l.inject)(f.Injections.factory)),o(2,(0,l.inject)(f.Injections.observer)),o(3,(0,l.inject)(f.Injections.config)),o(4,(0,l.inject)(f.Injections.funcs)),i("design:paramtypes",[c.Program,s.ProgramFactory,p.Observer,Object,Object])],h)},20480:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Map=void 0;const a=n(93176),c=n(60131),s=n(98392),u=n(38400),l=n(68947),f=n(36151);let d=class{constructor(e){this.main=e}type(){return a.OperationType.MAP}scope(){return a.OperationScope.LOCAL}async*handle(e){const t=await this.main.handle({operation:e.subject,isChild:!0});if(!t.success)return(0,s.failed)(void 0,t.message);const n=t.value.value,r=(await this.main.handle({operation:e.dictionary,isChild:!0})).value.value??[];let i=!1===e.trim?n:n.trim();const o=void 0===e.caseSensitive||!e.caseSensitive;i=o?i.toLowerCase():i;for(const e of r){if((o?e.key.map((e=>e.toLowerCase())):e.key).includes(i))return(0,s.succeeded)(e.value)}return(0,s.failed)(void 0,`Subject "${n}" was not found in any dictionary to map`)}};t.Map=d,r([(0,f.requiredFields)("subject","dictionary"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],d.prototype,"handle",null),t.Map=d=r([(0,u.injectable)(),o(0,(0,u.inject)(l.Injections.program)),i("design:paramtypes",[c.Program])],d)},70302:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.MathAction=void 0;const a=n(60131),c=n(99489),s=n(93176),u=n(98392),l=n(38400),f=n(68947),d=n(36151);let p=class{constructor(e,t){this.main=e,this.factory=t}type(){return s.OperationType.MATH}scope(){return s.OperationScope.LOCAL}async*handle(e){const t=this.factory.prototype(this.main),n=await t.handle({operation:e.left,isChild:!0});if(!n.success)return(0,u.failed)(void 0,n.message);const r=await t.handle({operation:e.right,isChild:!0});if(!r.success)return(0,u.failed)(void 0,r.message);const i=Number(n.value.value),o=Number(r.value.value);if(Number.isNaN(i))return(0,u.failed)(void 0,`Value "${n.value.value}" could not be parsed as number`);if(Number.isNaN(o))return(0,u.failed)(void 0,`Value "${r.value.value}" could not be parsed as number`);const a=this.mathHandlers[e.sign];if(!a)return(0,u.failed)(void 0,`Unsupportable math sign "${e.sign}"`);const c=a(i,o);return Number.isNaN(c)?(0,u.failed)(void 0,`Result is not a number. Left: "${i}". Right: "${o}". Sign: "${e.sign}"`):(0,u.succeeded)(c)}get mathHandlers(){return{"+":(e,t)=>e+t,"-":(e,t)=>e-t,"*":(e,t)=>e*t,"/":(e,t)=>e/t,"%":(e,t)=>e%t}}};t.MathAction=p,r([(0,d.requiredFields)("left","right","sign"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],p.prototype,"handle",null),t.MathAction=p=r([(0,l.injectable)(),o(0,(0,l.inject)(f.Injections.program)),o(1,(0,l.inject)(f.Injections.factory)),i("design:paramtypes",[a.Program,c.ProgramFactory])],p)},43914:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CallMethod=void 0;const a=n(93176),c=n(60131),s=n(98392),u=n(38400),l=n(68947),f=n(36151);let d=class{constructor(e){this.main=e}type(){return a.OperationType.CALL_METHOD}scope(){return a.OperationScope.LOCAL}async*handle(e){const t=await this.main.handle({operation:e.subject,isChild:!0});if(!t.success)return(0,s.failed)(void 0,t.message);const n=t.value.value,r=[];for(const t of e.args??[]){const e=await this.main.handle({operation:t,isChild:!0});r.push(e.value.value)}try{if("function"==typeof n[e.method]){const t=n[e.method].apply(n,r);return(0,s.succeeded)(t)}return(0,s.failed)(void 0,`Method "${e.method}" does not exist in prototype of "${e.subject.value}"`,a.NativeOperationType.NATIVE_ERROR)}catch(e){return(0,s.failed)(void 0,e.message,a.NativeOperationType.NATIVE_ERROR)}}};t.CallMethod=d,r([(0,f.requiredFields)("subject","method"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],d.prototype,"handle",null),t.CallMethod=d=r([(0,u.injectable)(),o(0,(0,u.inject)(l.Injections.program)),i("design:paramtypes",[c.Program])],d)},64753:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Constructor=void 0;const a=n(93176),c=n(60131),s=n(98392),u=n(38400),l=n(68947),f=n(36151);let d=class{constructor(e){this.main=e}type(){return a.OperationType.CONSTRUCTOR}scope(){return a.OperationScope.LOCAL}async*handle(e){const{constructor:t}=e;if(!(globalThis.hasOwnProperty(t)&&"function"==typeof globalThis[t]))return(0,s.failed)(void 0,`Constructor "${t}" does not exist`,a.NativeOperationType.NATIVE_ERROR);const n=globalThis[t];if(e.static)return(0,s.succeeded)(n);const r=[];for(const t of e.args??[]){const e=await this.main.handle({operation:t,isChild:!0});r.push(e.value.value)}try{const e=new n(...r);return(0,s.succeeded)(e)}catch(e){return(0,s.failed)(void 0,e.message,a.NativeOperationType.NATIVE_ERROR)}}};t.Constructor=d,r([(0,f.requiredFields)("constructor"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],d.prototype,"handle",null),t.Constructor=d=r([(0,u.injectable)(),o(0,(0,u.inject)(l.Injections.program)),i("design:paramtypes",[c.Program])],d)},49442:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.GetProperty=void 0;const a=n(93176),c=n(60131),s=n(98392),u=n(38400),l=n(68947),f=n(36151);let d=class{constructor(e){this.main=e}type(){return a.OperationType.GET_PROPERTY}scope(){return a.OperationScope.LOCAL}async*handle(e){const t=await this.main.handle({operation:e.subject,isChild:!0}),n=t.value.value;if(!t.success||!(0,s.isObject)(n))return(0,s.failed)(void 0,t.message);const r=n[(await this.main.handle({operation:e.prop,isChild:!0})).value.value];return(0,s.succeeded)(r)}};t.GetProperty=d,r([(0,f.requiredFields)("subject","prop"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],d.prototype,"handle",null),t.GetProperty=d=r([(0,u.injectable)(),o(0,(0,u.inject)(l.Injections.program)),i("design:paramtypes",[c.Program])],d)},82232:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.JsonParser=void 0;const a=n(93176),c=n(60131),s=n(98392),u=n(38400),l=n(68947),f=n(36151);let d=class{constructor(e){this.main=e}type(){return a.OperationType.JSON_PARSER}scope(){return a.OperationScope.LOCAL}async*handle(e){const t=(await this.main.handle({operation:e.value,isChild:!0})).value.value;try{const e=JSON.parse(t);return(0,s.succeeded)(e)}catch(e){return(0,s.failed)(void 0,`${e.message}. Parsed value - ${t}`,a.NativeOperationType.NATIVE_ERROR)}}};t.JsonParser=d,r([(0,f.requiredFields)("value"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],d.prototype,"handle",null),t.JsonParser=d=r([(0,u.injectable)(),o(0,(0,u.inject)(l.Injections.program)),i("design:paramtypes",[c.Program])],d)},7330:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.PriceParser=t.CURRENCY=void 0;const a=n(93176),c=n(98392),s=n(38400),u=n(60131),l=n(68947),f=n(36151);t.CURRENCY={$:{name:"U.S. Dollar",currency:"USD"},US$:{name:"U.S. Dollar",currency:"USD"},USD:{name:"U.S. Dollar",currency:"USD"},AED:{name:"Arab Emirates Dirham",currency:"AED"},:{name:"Arab Emirates Dirham",currency:"AED"},ARS:{name:"Argentine Peso",currency:"ARS"},AMD:{name:"Armenian Dram",currency:"AMD"},AWG:{name:"Aruban Florin",currency:"AWG"},A$:{name:"Australian Dollar",currency:"AUD"},AU$:{name:"Australian Dollar",currency:"AUD"},AUD:{name:"Australian Dollar",currency:"AUD"},AZN:{name:"Azerbaijan New Manat",currency:"AZN"},BSD:{name:"Bahamas Dollar",currency:"BSD"},BZD:{name:"Belize Dollar",currency:"BZD"},BOB:{name:"Bolivian Boliviano",currency:"BOB"},R$:{name:"Brazilian Real",currency:"BRL"},BRL:{name:"Brazilian Real",currency:"BRL"},BND:{name:"Bruneian Dollar",currency:"BND"},BGN:{name:"Bulgaria Lev",currency:"BGN"},KHR:{name:"Cambodian Riel",currency:"KHR"},KYD:{name:"Caymanian Dollar",currency:"KYD"},KYD$:{name:"Caymanian Dollar",currency:"KYD"},CI$:{name:"Caymanian Dollar",currency:"KYD"},CLP:{name:"Chilean Peso",currency:"CLP"},"CN":{name:"Chinese Yuan Renminbi",currency:"CNY"},CNY:{name:"Chinese Yuan Renminbi",currency:"CNY"},COP:{name:" Colombian Peso",currency:"COP"},CRC:{name:"Costa Rican Colon",currency:"CRC"},DOP:{name:"Dominican Republic Peso",currency:"DOP"},EC$:{name:"East Caribbean Dollar",currency:"XCD"},XCD:{name:"East Caribbean Dollar",currency:"XCD"},EGP:{name:"Egyptian Pound",currency:"EGP"},"":{name:"Euro",currency:"EUR"},EUR:{name:"Euro",currency:"EUR"},GHS:{name:"Ghanaian Cedi",currency:"GHS"},GTQ:{name:"Guatemalan Quetzal",currency:"GTQ"},HNL:{name:"Honduran Lempira",currency:"HNL"},HK$:{name:"Honduran Lempira",currency:"HKD"},HKD:{name:"Honduran Lempira",currency:"HKD"},HUF:{name:"Hungarian Forint",currency:"HUF"},"":{name:"Indian Rupee",currency:"INR"},INR:{name:"Indian Rupee",currency:"INR"},IDR:{name:"Indonesian Rupiah",currency:"IDR"},"":{name:"Israeli Shekel",currency:"ILS"},ILS:{name:"Israeli Shekel",currency:"ILS"},JMD:{name:"Jamaican Dollar",currency:"JMD"},"":{name:"Japanese Yen",currency:"JPY"},JPY:{name:"Japanese Yen",currency:"JPY"},"JP":{name:"Japanese Yen",currency:"JPY"},"":{name:"Japanese Yen",currency:"JPY"},KZT:{name:"Kazakhstan Tenge",currency:"KZT"},KES:{name:"Kenyan Shilling",currency:"KES"},LBP:{name:"Lebanese Pound",currency:"LBP"},MOP:{name:"Macanese Pataca",currency:"MOP"},MOP$:{name:"Macanese Pataca",currency:"MOP"},MYR:{name:"Malaysian Ringgit",currency:"MYR"},MUR:{name:"Mauritian Rupee",currency:"MUR"},MX$:{name:"Mexico Peso",currency:"MXN"},MXN:{name:"Mexico Peso",currency:"MXN"},MNT:{name:"Mongolian Tugrik",currency:"MNT"},MAD:{name:"Moroccan Dirham",currency:"MAD"},NAD:{name:"Namibia Dollar",currency:"NAD"},NZ$:{name:"New Zealand Dollar",currency:"NZD"},NZD:{name:"New Zealand Dollar",currency:"NZD"},NGN:{name:"Nigerian Naira",currency:"NGN"},NOK:{name:"Norwegian Krone",currency:"NOK"},PAB:{name:"Panamanian Balboa",currency:"PAB"},PYG:{name:"Paraguayan Guarani",currency:"PYG"},PEN:{name:"Peruvian Sol",currency:"PEN"},PHP:{name:"Philippine Peso",currency:"PHP"},"":{name:"Pounds",currency:"GBP"},GBP:{name:"Pounds",currency:"GBP"},QAR:{name:"Qatari Riyal",currency:"QAR"},RUB:{name:"Russian Ruble",currency:"RUB"},SAR:{name:"Saudi Arabian Riyal",currency:"SAR"},:{name:"Saudi Arabian Riyal",currency:"SAR"},SGD:{name:"Singapore Dollar",currency:"SGD"},ZAR:{name:"South African Rand",currency:"ZAR"},"":{name:"South Korean Won",currency:"KRW"},KRW:{name:"South Korean Won",currency:"KRW"},NT$:{name:"Taiwan New Dollar",currency:"TWD"},TWD:{name:"Taiwan New Dollar",currency:"TWD"},TZS:{name:"Tanzania Shilling",currency:"TZS"},THB:{name:"Thai Baht",currency:"THB"},TTD:{name:"Trinidadian Dollar",currency:"TTD"},TRY:{name:"Turkish Lira",currency:"TRY"},UYU:{name:"Uruguayan Peso",currency:"TRY"},"":{name:"Armenian Dram",currency:"AMD"},"":{name:"Azerbaijani Manat",currency:"AZN"},BAM:{name:"Bosnia and Herzegovina Convertible Mark",currency:"BAM"},KM:{name:"Bosnia and Herzegovina Convertible Mark",currency:"BAM"},:{name:"Bulgarian lev",currency:"BGN"},BHD:{name:"Bahraini Dinar",currency:"BHD"},".":{name:"Bahraini Dinar",currency:"BHD"},BD:{name:"Bahraini Dinar",currency:"BHD"},B$:{name:"Brunei Dollar",currency:"BND"},BYN:{name:"Belarusian Ruble",currency:"BYN"},Br:{name:"Belarusian Ruble",currency:"BYN"},CAD:{name:"Canadian Dollar",currency:"CAD"},C$:{name:"Canadian Dollar",currency:"CAD"},CA$:{name:"Canadian Dollar",currency:"CAD"},CHF:{name:"Swiss Franc",currency:"CHF"},Fr:{name:"Swiss Franc",currency:"CHF"},Col$:{name:" Colombian Peso",currency:"COP"},CZK:{name:"Czech Koruna",currency:"CZK"},K:{name:"Czech Koruna",currency:"CZK"},DJF:{name:"Djiboutian Franc",currency:"DJF"},Fdj:{name:"Djiboutian Franc",currency:"DJF"},DKK:{name:"Danish Krone",currency:"DKK"},kr:{name:"Swedish Krona",currency:"SEK"},DZD:{name:"Algerian Dinar ",currency:"DZD"},:{name:"Algerian Dinar ",currency:"DZD"},DA:{name:"Algerian Dinar ",currency:"DZD"},GEL:{name:"Georgian Lari",currency:"GEL"},:{name:"Georgian Lari",currency:"GEL"},"GH":{name:"Ghanaian Cedi ",currency:"GHS"},GNF:{name:"Guinean Franc",currency:"GNF"},FG:{name:"Guinean Franc",currency:"GNF"},Ft:{name:"Hungarian Forint",currency:"HUF"},Rp:{name:"Indonesian Rupiah",currency:"IDR"},ISK:{name:"Icelandic Krna",currency:"ISK"},kr:{name:"Icelandic Krna",currency:"ISK"},JOD:{name:"Jordanian Dinar",currency:"JOD"},JD:{name:"Jordanian Dinar",currency:"JOD"},KGS:{name:"Kyrgyzstani Som",currency:"KGS"},:{name:"Kyrgyzstani Som",currency:"KGS"},"":{name:"Cambodian Riel",currency:"KHR"},KWD:{name:"Kuwaiti Dinar",currency:"KWD"},"K.D.":{name:"Kuwaiti Dinar",currency:"KWD"},"":{name:"Kazakhstani Tenge",currency:"KZT"},LVL:{name:"Latvian Lats",currency:"LVL"},Ls:{name:"Latvian Lats",currency:"LVL"},DH:{name:"Moroccan Dirham",currency:"MAD"},MDL:{name:"Moldovan Leu ",currency:"MDL"},L:{name:"Romanian Leu",currency:"RON"},MKD:{name:"Macedonian Denar",currency:"MKD"},:{name:"Macedonian Denar",currency:"MKD"},MVR:{name:"Maldivian Rufiyaa",currency:"MVR"},:{name:"Maldivian Rufiyaa",currency:"MVR"},MWK:{name:"Malawian Kwacha",currency:"MWK"},MK:{name:"Malawian Kwacha",currency:"MWK"},Mex$:{name:"Mexican Peso",currency:"MXN"},RM:{name:"Malaysian Ringgit",currency:"MYR"},N:{name:"Nigerian Naira",currency:"NGN"},"":{name:"Nigerian Naira",currency:"NGN"},NPR:{name:"Nepalese Rupee ",currency:"NPR"},:{name:"Nepalese Rupee ",currency:"NPR"},OMR:{name:"Omani Rial",currency:"OMR"},"S/":{name:"Peruvian Nuevo Sol",currency:"PEN"},"":{name:"Philippine Peso",currency:"PHP"},PKR:{name:"Pakistani Rupee",currency:"PKR"},"":{name:"Pakistani Rupee",currency:"PKR"},PLN:{name:"Polish Zloty",currency:"PLN"},z:{name:"Polish Zloty",currency:"PLN"},QR:{name:"Qatari Riyal",currency:"QAR"},RON:{name:"Romanian Leu",currency:"RON"},lei:{name:"Romanian Leu",currency:"RON"},RSD:{name:"Serbian Dinar ",currency:"RSD"},:{name:"Serbian Dinar ",currency:"RSD"},"":{name:"Russian Ruble",currency:"RUB"},RWF:{name:"Rwandan Franc",currency:"RWF"},FRw:{name:"Rwandan Franc",currency:"RWF"},".":{name:"Saudi Riyal",currency:"SAR"},SEK:{name:"Swedish Krona",currency:"SEK"},SG$:{name:"Singapore Dollar",currency:"SGD"},STN:{name:"Sao Tome and Principe Dobra",currency:"STN"},Db:{name:"Sao Tome and Principe Dobra",currency:"STN"},SZL:{name:"Swazi Lilangeni",currency:"SZL"},E:{name:"Swazi Lilangeni",currency:"SZL"},"":{name:"Thai Baht",currency:"THB"},TOP:{name:"Tongan Paanga",currency:"TOP"},T$:{name:"Tongan Paanga",currency:"TOP"},TL:{name:"Turkish Lira",currency:"TRY"},"":{name:"Turkish Lira",currency:"TRY"},UAH:{name:"Ukrainian Hryvnia",currency:"UAH"},"":{name:"Ukrainian Hryvnia",currency:"UAH"},UGX:{name:"Ugandan Shilling",currency:"UGX"},USh:{name:"Ugandan Shilling",currency:"UGX"},UZS:{name:"Uzbekistan Som",currency:"UZS"},som:{name:"Uzbekistan Som",currency:"UZS"},VEF:{name:"Venezuelan Bolvar Fuerte",currency:"VEF"},"Bs.F.":{name:"Venezuelan Bolvar Fuerte",currency:"VEF"},vef:{name:"Venezuelan Bolvar Fuerte",currency:"VEF"},VND:{name:"Vietnamese Dong",currency:"VND"},"":{name:"Vietnamese Dong",currency:"VND"},XAF:{name:"Central African CFA Franc",currency:"XAF"},"F.CFA":{name:"Central African CFA Franc",currency:"XAF"},CFA:{name:"Central African CFA Franc",currency:"XAF"},YER:{name:"Yemeni Rial",currency:"YER"},"":{name:"Yemeni Rial",currency:"YER"},R:{name:"South African Rand",currency:"ZAR"}},(0,c.deepFreeze)(t.CURRENCY);const d=["BHD","JOD","KWD","OMR"];let p=class{constructor(e){this.main=e,this.separators=[",","."]}type(){return a.OperationType.PRICE_PARSER}scope(){return a.OperationScope.LOCAL}async*handle(e){let n,r="",i=0;const o=Boolean(e.validateCurrency??!0),s=await this.main.handle({operation:e.price,isChild:!0});if(!s.success)return(0,c.failed)(void 0,s.message);const u=s.value.value;if("string"!=typeof u)return(0,c.failed)(void 0,`Input value is not a string. Type: ${typeof u}. Value - ${JSON.stringify(u)}`,a.NativeOperationType.NATIVE_ERROR);const l=u.replace(/(\s|&nbsp;)/g,""),f=l.trim().split(" ").join(""),d=l.includes("-"),p=d?f.replace("-",""):f;if(0===p.length)return(0,c.failed)(void 0,"Input string is empty");for(let e=0;e<p.length;e++){const t=p[e];this.separators.includes(t)?r+=".":Number.isNaN(+t)?(void 0===n&&(n=e),i+=1):r+=t}let h=r.trim();const y=n,g=y+i,v=p.substring(y,g).trim(),m=t.CURRENCY.hasOwnProperty(v)?t.CURRENCY[v].currency:null;if(o&&null==m)return(0,c.failed)(void 0,"Currency is not defined");const b=h.split("."),_=this.checkSubDivided(h,m);if(b.length>1)if(_){const e=b.pop();h=`${b.join("")}.${e}`}else h=`${b.join("")}`;const w=parseFloat(h);if(Number.isNaN(w))return(0,c.failed)(void 0,`Final price "${h}" could not be parsed from initial value "${u}"`);const R={price:e.modulus?Math.abs(w):d?-w:w,currency:m};return(0,c.succeeded)(R)}checkSubDivided(e,t){const n=d.includes(t)?-4:-3;return this.separators.includes(Array.prototype.at.call(e,n))}};t.PriceParser=p,r([(0,f.requiredFields)("price"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],p.prototype,"handle",null),t.PriceParser=p=r([(0,s.injectable)(),o(0,(0,s.inject)(l.Injections.program)),i("design:paramtypes",[u.Program])],p)},91497:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ReturnOperationHandler=void 0;const a=n(93176),c=n(38400),s=n(68947),u=n(60131),l=n(98392),f=n(36151);let d=class{constructor(e){this.main=e}type(){return a.OperationType.RETURN}scope(){return a.OperationScope.LOCAL}async*handle(e){const t=await this.main.handle({operation:e.value,isChild:!0});return t.success?{...(0,l.succeeded)(t.value.value),return:!0}:(0,l.failed)(t.value.value,t.message)}};t.ReturnOperationHandler=d,r([(0,f.requiredFields)("value"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],d.prototype,"handle",null),t.ReturnOperationHandler=d=r([(0,c.injectable)(),o(0,(0,c.inject)(s.Injections.program)),i("design:paramtypes",[u.Program])],d)},19008:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Plural=void 0;const a=n(33214),c=n(93176),s=n(68253),u=n(71979),l=n(98392),f=n(33838),d=n(38400),p=n(68947),h=n(36151);let y=class extends a.BaseHandler{constructor(e,t,n){super(),this.selectorsSolver=e,this.elementSolver=t,this.elScope=n}type(){return c.OperationType.PLURAL}scope(){return c.OperationScope.LOCAL}async*handle(e){let t=this.elScope;if(null!=e.scope){const n=await this.elementSolver.solve(e.scope);if(!n.success)return(0,l.failed)(void 0,n.message);t=n.value.value}const n=await this.selectorsSolver.solve(e.selectors);if(!n.success)return(0,l.failed)(void 0,n.message);const r=n.value.value;for(const n of r){let r;try{if(r=t.querySelectorAll(n),0===r.length)continue}catch(e){return(0,l.failed)(void 0,e.message,c.NativeOperationType.NATIVE_ERROR)}const i=[];return r.forEach((t=>i.push((0,f.getter)(e,t)))),(0,l.succeeded)(i)}return(0,l.failed)(void 0,`No elements by selectors "${JSON.stringify(r)}" were found`)}};t.Plural=y,r([(0,h.requiredFields)("selectors"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],y.prototype,"handle",null),t.Plural=y=r([(0,d.injectable)(),o(0,(0,d.inject)(p.Injections.selectorsSolver)),o(1,(0,d.inject)(p.Injections.htmlElementSolver)),o(2,(0,d.inject)(p.Injections.elScope)),i("design:paramtypes",[u.SelectorsSolver,s.HtmlElementSolver,Object])],y)},72813:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Single=void 0;const a=n(33214),c=n(68253),s=n(71979),u=n(98392),l=n(33838),f=n(93176),d=n(38400),p=n(68947),h=n(36151);let y=class extends a.BaseHandler{constructor(e,t,n){super(),this.selectorsSolver=e,this.elementSolver=t,this.elScope=n}type(){return f.OperationType.SINGLE}scope(){return f.OperationScope.LOCAL}async*handle(e){let t=this.elScope;if(null!=e.scope){const n=await this.elementSolver.solve(e.scope);if(!n.success)return(0,u.failed)(void 0,n.message);t=n.value.value}const n=await this.selectorsSolver.solve(e.selectors);if(!n.success)return(0,u.failed)(void 0,n.message);const r=n.value.value;try{for(const n of r){const r=t.querySelector(n);if(null==r)continue;const i=(0,l.getter)(e,r);return(0,u.succeeded)(i)}}catch(e){return(0,u.failed)(void 0,e.message,f.NativeOperationType.NATIVE_ERROR)}return(0,u.failed)(void 0,`No element with selectors "${JSON.stringify(r)}" were found`)}};t.Single=y,r([(0,h.requiredFields)("selectors"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],y.prototype,"handle",null),t.Single=y=r([(0,d.injectable)(),o(0,(0,d.inject)(p.Injections.selectorsSolver)),o(1,(0,d.inject)(p.Injections.htmlElementSolver)),o(2,(0,d.inject)(p.Injections.elScope)),i("design:paramtypes",[s.SelectorsSolver,c.HtmlElementSolver,Object])],y)},95190:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SplitScope=void 0;const a=n(93176),c=n(71979),s=n(99489),u=n(98392),l=n(38400),f=n(17329),d=n(68947),p=n(60131),h=n(36151);let y=class{constructor(e,t,n,r,i,o,a){this.selectorsSolver=e,this.elScope=t,this.observer=n,this.factory=r,this.config=i,this.funcs=o,this.main=a}type(){return a.OperationType.SPLIT_SCOPE}scope(){return a.OperationScope.BLOCK}async*handle(e){const t=await this.selectorsSolver.solve(e.selectors);if(!t.success)return(0,u.failed)(void 0,t.message);let n=!1;if(e.breakOnError){const t=await this.main.handle({operation:e.breakOnError,isChild:!0});if(!t.success)return(0,u.failed)(void 0,t.message);n=t.value.value}const r=t.value.value;for(const t of r)try{const r=this.elScope.querySelectorAll(t);if(0===r.length)continue;const i=[];for(const t in r){const o=r[t],c={};let s=!0;const l=this.factory.create(this.config,this.observer,o,this.main.getGlobalScope(),this.funcs,!1,c),f={var:"$index",type:a.OperationType.LITERAL,value:t};await l.handle({operation:f,isChild:!0});for(const[t,r]of Object.entries(e.operations)){const e={var:"$scope",type:a.OperationType.LITERAL,value:o};await l.handle({operation:e,isChild:!0}),l.mergeLocalScope(this.main.programScope(!0));const i=await l.handle({operation:r,index:t});if(!i.success&&!r.optional){if(n)return(0,u.failed)(void 0,i.message);s=!1;break}this.clearScopeWith(c,[...Object.keys(this.main.getLocalScope()),...Object.keys(this.main.getGlobalScope()),e.var])}s&&(this.clearScopeWith(c,[f.var]),i.push(c))}return(0,u.succeeded)(i)}catch(e){return(0,u.failed)(void 0,e.message,a.NativeOperationType.NATIVE_ERROR)}return(0,u.failed)(void 0,"No scopes were found")}clearScopeWith(e,t){t.forEach((t=>{delete e[t]}))}};t.SplitScope=y,r([(0,h.requiredFields)("operations","selectors"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],y.prototype,"handle",null),t.SplitScope=y=r([(0,l.injectable)(),o(0,(0,l.inject)(d.Injections.selectorsSolver)),o(1,(0,l.inject)(d.Injections.elScope)),o(2,(0,l.inject)(d.Injections.observer)),o(3,(0,l.inject)(d.Injections.factory)),o(4,(0,l.inject)(d.Injections.config)),o(5,(0,l.inject)(d.Injections.funcs)),o(6,(0,l.inject)(d.Injections.program)),i("design:paramtypes",[c.SelectorsSolver,Object,f.Observer,s.ProgramFactory,Object,Object,p.Program])],y)},32950:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Replace=void 0;const a=n(93176),c=n(99489),s=n(98392),u=n(38400),l=n(68947),f=n(60131),d=n(36151);let p=class{constructor(e,t){this.main=e,this.factory=t}type(){return a.OperationType.REPLACE}scope(){return a.OperationScope.LOCAL}async*handle(e){const t=this.factory.prototype(this.main),n=await t.handle({operation:e.subject,isChild:!0});if(!n.success)return(0,s.failed)(void 0,n.message);const r=await t.handle({operation:e.needle,isChild:!0});if(!r.success)return(0,s.failed)(void 0,r.message);const i=await t.handle({operation:e.replacement,isChild:!0});if(!i.success)return(0,s.failed)(void 0,i.message);const o=e.mode?e.mode:"first",c=this.handler(o);if(!c)return(0,s.failed)(void 0,"Unsupportable replacementResult mode",a.NativeOperationType.NATIVE_ERROR);let u=n.value.value;const l=i.value.value;return(Array.isArray(r.value.value)?r.value.value:[r.value.value]).forEach((e=>{u=c(u,e,l)})),this.main.mergeLocalScope(t.getLocalScope()),(0,s.succeeded)(u)}handler(e){return{first:(e,t,n)=>e.replace(t,n),all:(e,t,n)=>e.replace(new RegExp(t,"g"),n)}[e]}};t.Replace=p,r([(0,d.requiredFields)("subject","needle","replacement"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],p.prototype,"handle",null),t.Replace=p=r([(0,u.injectable)(),o(0,(0,u.inject)(l.Injections.program)),o(1,(0,u.inject)(l.Injections.factory)),i("design:paramtypes",[f.Program,c.ProgramFactory])],p)},6519:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ReplaceBetween=void 0;const a=n(93176),c=n(99489),s=n(98392),u=n(38400),l=n(68947),f=n(60131),d=n(36151);let p=class{constructor(e,t){this.main=e,this.factory=t}type(){return a.OperationType.REPLACE_BETWEEN}scope(){return a.OperationScope.LOCAL}async*handle(e){const t=this.factory.prototype(this.main),n=await t.handle({operation:e.subject,isChild:!0});if(!n.success)return(0,s.failed)(void 0,n.message);const r=await t.handle({operation:e.start,isChild:!0});if(!r.success)return(0,s.failed)(void 0,r.message);const i=await t.handle({operation:e.end,isChild:!0});if(!i.success)return(0,s.failed)(void 0,i.message);const o=await t.handle({operation:e.replacement,isChild:!0});if(!o.success)return(0,s.failed)(void 0,o.message);const a=this.replaceBetween(n.value.value,o.value.value,r.value.value,i.value.value);return this.main.mergeLocalScope(t.getLocalScope()),(0,s.succeeded)(a)}replaceBetween(e,t,n,r){const i=e.indexOf(n);if(-1===i)return e;const o=e.lastIndexOf(r);if(-1===o)return e;return e.substring(0,i)+t+e.substring(o+r.length)}};t.ReplaceBetween=p,r([(0,d.requiredFields)("subject","start","end","replacement"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],p.prototype,"handle",null),t.ReplaceBetween=p=r([(0,u.injectable)(),o(0,(0,u.inject)(l.Injections.program)),o(1,(0,u.inject)(l.Injections.factory)),i("design:paramtypes",[f.Program,c.ProgramFactory])],p)},97163:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Variable=void 0;const a=n(93176),c=n(38400),s=n(68947),u=n(98392),l=n(36151),f=n(60131);let d=class{constructor(e){this.main=e}type(){return a.OperationType.VAR}scope(){return a.OperationScope.LOCAL}async*handle(e){const t=e.value.split(".");let n=this.main.programScope(!1);for(let e=0;e<t.length-1;e++){const r=n[t[e]];(0,u.isObject)(r)&&(n=n[t[e]])}const r=n[t.at(-1)];return(e.acceptNull?void 0===r:null==r)?(0,u.failed)(void 0,`Variable "${e.value}" is not defined`):(0,u.succeeded)(r)}};t.Variable=d,r([(0,l.requiredFields)("value"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],d.prototype,"handle",null),t.Variable=d=r([(0,c.injectable)(),o(0,(0,c.inject)(s.Injections.program)),i("design:paramtypes",[f.Program])],d)},32065:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.MarkProcessedElement=void 0;const a=n(93176),c=n(98392),s=n(38400),u=n(68947),l=n(36151);let f=class{constructor(e){this.elScope=e}type(){return a.OperationType.MARK_PROCESSED_ELEMENT}scope(){return a.OperationScope.LOCAL}async*handle(e){for(const t of e.selectors){let e;try{e=this.elScope.querySelector(t)}catch(e){continue}if(null!=e)return e.setAttribute("data-lib-processed","true"),(0,c.succeeded)(!0)}return(0,c.failed)(!1,"No element was found to process")}};t.MarkProcessedElement=f,r([(0,l.requiredFields)("selectors"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],f.prototype,"handle",null),t.MarkProcessedElement=f=r([(0,s.injectable)(),o(0,(0,s.inject)(u.Injections.elScope)),i("design:paramtypes",[Object])],f)},94862:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.WaitForNotProcessedElementHandler=void 0;const a=n(93176),c=n(98392),s=n(38400),u=n(68947),l=n(36151);let f=class{constructor(e){this.elScope=e}type(){return a.OperationType.WAIT_FOR_NOT_PROCESSED_ELEMENT}scope(){return a.OperationScope.LOCAL}async*handle(e){return await new Promise((t=>{const n=setInterval((()=>{for(const i of e.selectors){let e;try{e=this.elScope.querySelector(i)}catch(e){continue}null!=e&&(e.hasAttribute("data-lib-processed")||(clearInterval(n),clearTimeout(r),t((0,c.succeeded)(!0))))}}),500),r=setTimeout((()=>{clearInterval(n),t((0,c.failed)(!1,"Some element was already processed, or selectors was not found"))}),e.timeout)}))}};t.WaitForNotProcessedElementHandler=f,r([(0,l.requiredFields)("selectors","timeout"),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Object)],f.prototype,"handle",null),t.WaitForNotProcessedElementHandler=f=r([(0,s.injectable)(),o(0,(0,s.inject)(u.Injections.elScope)),i("design:paramtypes",[Object])],f)},99489:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.ProgramFactory=void 0;const i=n(60131),o=n(18028),a=n(43914),c=n(27578),s=n(40164),u=n(425),l=n(31995),f=n(63778),d=n(58876),p=n(82232),h=n(24224),y=n(69767),g=n(20480),v=n(32065),m=n(47607),b=n(19008),_=n(7330),w=n(91497),R=n(30819),j=n(72813),O=n(95190),S=n(97163),E=n(94862),A=n(49442),T=n(64491),C=n(42205),I=n(90010),M=n(32950),D=n(6519),P=n(70302),N=n(38400),L=n(64753),x=n(80031);let F=class{create(e,t,n,r={},o,a=!1,c={}){const s=new i.Program(e,t,n,r,o,this,this.handlers(),c);return a&&s.initTrace(),s}prototype(e){return this.create(e.getConfig(),e.getObserver(),e.getElScopeRef(),e.getGlobalScope(),e.getFuncsRef(),!1,e.cloneLocalScope())}handlers(){return{CLOSEST:c.Closest,EXIST:u.ExistElement,IS_NOT_HIDDEN_ELEMENT:d.IsNotHiddenElement,SELECT:R.Select,AND:o.And,CONDITION:I.Condition,OR:m.Or,FLOW:C.Flow,FOR_EACH:l.ForEach,MATH:P.MathAction,CALL_METHOD:a.CallMethod,GET_PROPERTY:A.GetProperty,JSON_PARSER:p.JsonParser,PRICE_PARSER:_.PriceParser,PLURAL:b.Plural,SINGLE:j.Single,SPLIT_SCOPE:O.SplitScope,REPLACE:M.Replace,REPLACE_BETWEEN:D.ReplaceBetween,MARK_PROCESSED_ELEMENT:v.MarkProcessedElement,WAIT_FOR_NOT_PROCESSED_ELEMENT:E.WaitForNotProcessedElementHandler,COMPUTED:s.Computed,EMIT:T.Emit,FUNC:f.Func,LITERAL:h.Literal,LOG:y.Log,MAP:g.Map,RETURN:w.ReturnOperationHandler,VAR:S.Variable,CONSTRUCTOR:L.Constructor,INTERRUPT:x.Interrupt}}};t.ProgramFactory=F,t.ProgramFactory=F=r([(0,N.injectable)()],F)},60131:function(e,t,n){"use strict";var r,i=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.Program=void 0;const a=n(93176),c=n(17329),s=n(99489),u=n(98392),l=n(20069),f=n(38400),d=n(68253),p=n(71979),h=n(68947),y=n(99664),g=n(62453),v=n(73238);let m=r=class{constructor(e,t,n,r,i,o,a,c={}){this.config=e,this.observer=t,this.elScope=n,this.varScope=r,this.funcs=i,this.localScope=c,this.operations={},this.globalScope=(0,u.deepFreeze)((0,u.clone)(r)),this.localScope=c,this.di=new f.Container,this.injectDependencies(o,a)}getConfig(){return this.config}getElScopeRef(){return this.elScope}getLocalScope(){return this.localScope}getGlobalScope(){return this.globalScope}cloneLocalScope(){return(0,u.clone)(this.getLocalScope())}mergeLocalScope(e){return Object.assign(this.getLocalScope(),e),this.getLocalScope()}getFuncsRef(){return this.funcs}getObserver(){return this.observer}programScope(e){return e?Object.assign({},this.getGlobalScope(),this.cloneLocalScope()):Object.assign({},this.getGlobalScope(),this.getLocalScope())}getOperationsList(){return this.operations}getTrace(e){return r.tracer.trace(e)}initTrace(){r.tracer.init(this.getGlobalScope())}async handle({operation:e,isChild:t=!1,index:n="0"}){if(null==e?.type)return(0,u.failed)(void 0,"Operation type is not provided",a.NativeOperationType.NATIVE_ERROR);if(!this.operations[e?.type])return(0,u.failed)(void 0,`Unsupportable operation type "${e?.type}"`,a.NativeOperationType.NATIVE_ERROR);const i=this.getLocalScope(),o=this.getGlobalScope();e.debug&&(this.logger.forceLog("DEBUG: operation",e),this.logger.forceLog("DEBUG: localScope",i),this.logger.forceLog("DEBUG: globalScope",o)),t||r.operationTracer.push(e,n,i);const c=await this.handleOperation(e),s=await this.handleAccumulated(e),l=await this.handleResult(e,this.programScope(!1),c,s);return t||!l.success||r.operationTracer.pop(e),l}async handleResult(e,t,n,r){try{if(e.var){const i=e.var.split(".");let o=t;for(let e=0;e<i.length-1;e++)o.hasOwnProperty(i[e])||(o[i[e]]={}),o=o[i[e]];const a=i[i.length-1];if(r){const e=null!=o[a],t=[o[a],n.value.value],r=[n.value.value];o[a]=Array.isArray(o[a])?[...o[a],n.value.value]:e?t:r}else o[a]=n.value.value;this.mergeLocalScope(t)}return n}catch(e){return(0,u.failed)(void 0,e.message,a.NativeOperationType.NATIVE_ERROR)}}async handleOperation(e){const t=this.operations[e.type].handle(e);let n,i;do{i=await t.next(),n=i.value,i.done||r.operationTracer.replaceFirst(n)}while(!i.done);return n}async handleAccumulated(e){if(null!=e.accumulate){let t,n;const r=this.operations[e.accumulate.type].handle(e.accumulate);do{n=await r.next(),t=n.value}while(!n.done);return t.value.value}return!1}injectDependencies(e,t){this.di.bind(h.Injections.program).toConstantValue(this),this.injectServices(e),this.injectTracer(),this.injectOperations(t),this.logger=this.di.get(h.Injections.logger)}injectServices(e){this.di.bind(h.Injections.htmlElementSolver).to(d.HtmlElementSolver).inSingletonScope(),this.di.bind(h.Injections.selectorsSolver).to(p.SelectorsSolver).inSingletonScope(),this.di.bind(h.Injections.logger).to(l.MyLogger).inSingletonScope(),this.di.bind(h.Injections.observer).toConstantValue(this.observer),this.di.bind(h.Injections.factory).toConstantValue(e),this.di.bind(h.Injections.config).toConstantValue(this.config),this.di.bind(h.Injections.elScope).toConstantValue(this.elScope),this.di.bind(h.Injections.funcs).toConstantValue(this.funcs)}injectOperations(e){Object.values(e).forEach((e=>{const t=e.prototype.type();this.di.bind(t).to(e).inSingletonScope();const n=this.di.get(t);this.operations[n.type()]=n}))}injectTracer(){r.loggerTracer?this.di.bind(h.Injections.loggerTracer).toConstantValue(r.loggerTracer):(this.di.bind(h.Injections.loggerTracer).to(y.LoggerTracer).inSingletonScope(),r.loggerTracer=this.di.get(h.Injections.loggerTracer)),r.operationTracer?this.di.bind(h.Injections.operationTracer).toConstantValue(r.operationTracer):(this.di.bind(h.Injections.operationTracer).to(g.OperationTracer).inSingletonScope(),r.operationTracer=this.di.get(h.Injections.operationTracer)),r.tracer?this.di.bind(h.Injections.tracer).toConstantValue(r.tracer):(this.di.bind(h.Injections.tracer).to(v.Tracer).inSingletonScope(),r.tracer=this.di.get(h.Injections.tracer))}};t.Program=m,t.Program=m=r=i([(0,f.injectable)(),o("design:paramtypes",[Object,c.Observer,Object,Object,Object,s.ProgramFactory,Object,Object])],m)},68947:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.Injections=void 0,function(e){e.logger="LOGGER",e.observer="OBSERVER",e.program="PROGRAM",e.factory="FACTORY",e.config="CONFIG",e.elScope="ELEMENT_SCOPE",e.funcs="FUNCTIONS",e.htmlElementSolver="HTML_ELEMENT_SOLVER",e.selectorsSolver="SELECTORS_SOLVER",e.loggerTracer="LOGGER_TRACER",e.operationTracer="OPERATION_TRACER",e.tracer="TRACER"}(n||(t.Injections=n={}))},68253:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.HtmlElementSolver=void 0;const a=n(60131),c=n(98392),s=n(38400),u=n(68947),l=n(93176);let f=class{constructor(e){this.main=e}async solve(e){try{const t=await this.main.handle({operation:e,isChild:!0});return t.success?t.value.value instanceof HTMLElement?(0,c.succeeded)(t.value.value):(0,c.failed)(void 0,'Argument for "scope" must be an instance of "HTMLElement"'):(0,c.failed)(void 0,t.message)}catch(e){return(0,c.failed)(void 0,e.message,l.NativeOperationType.NATIVE_ERROR)}}};t.HtmlElementSolver=f,t.HtmlElementSolver=f=r([(0,s.injectable)(),o(0,(0,s.inject)(u.Injections.program)),i("design:paramtypes",[a.Program])],f)},71979:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SelectorsSolver=void 0;const a=n(60131),c=n(98392),s=n(38400),u=n(68947),l=n(93176);let f=class{constructor(e){this.main=e}async solve(e){if(!Array.isArray(e)||0===e.length)return(0,c.failed)(void 0,'Argument for "selectors" must be non-empty an array',l.NativeOperationType.NATIVE_ERROR);const t=[];for(const n of e){const e=await this.main.handle({operation:n,isChild:!0});if((0,c.isFailed)(e,n))return(0,c.failed)(void 0,e.message);t.push(e.value.value)}return(0,c.succeeded)(t)}};t.SelectorsSolver=f,t.SelectorsSolver=f=r([(0,s.injectable)(),o(0,(0,s.inject)(u.Injections.program)),i("design:paramtypes",[a.Program])],f)},33214:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseHandler=void 0;const i=n(38400);let o=class{};t.BaseHandler=o,t.BaseHandler=o=r([(0,i.injectable)()],o)},33838:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getter=void 0;const r=n(93176);t.getter=function(e,t){const n={[r.SINGLE_GET_TYPE.TEXT]:()=>{const e=t;return(e.innerText||e.textContent).trim()},[r.SINGLE_GET_TYPE.VALUE]:()=>t.value,[r.SINGLE_GET_TYPE.ATTRIBUTE]:()=>t.getAttribute(e.attr)};return n[e.get]?n[e.get]():n[r.SINGLE_GET_TYPE.TEXT]()}},20069:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.MyLogger=void 0;const a=n(38400),c=n(68947);let s=class{constructor(e){this.config=e,this.loggerLabel="%c[JSON-EXTRACTOR]",this.loggerLabelStyle="background-color: greenyellow; font-weight: bold; padding: 2px;"}log(e,...t){this.config.log}error(e,...t){this.config.log}forceLog(e,...t){}};t.MyLogger=s,t.MyLogger=s=r([(0,a.injectable)(),o(0,(0,a.inject)(c.Injections.config)),i("design:paramtypes",[Object])],s)},17329:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.Observer=void 0;const i=n(38400);let o=class{constructor(){this.listeners={}}emit(e,t){this.listeners[e]&&this.listeners[e].forEach((e=>{e(t)}))}subscribe(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}};t.Observer=o,t.Observer=o=r([(0,i.injectable)()],o)},99664:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerTracer=void 0;const i=n(38400),o=n(98392);let a=class{constructor(){this.logTrace=[]}log(e,t={}){const n={message:e,args:this.clonedArguments(t)};this.logTrace.push(n)}trace(){return this.logTrace.map((e=>e))}clear(){this.logTrace=[]}clonedArguments(e={}){return Object.entries(e).reduce(((e,[t,n])=>[...e,{var:t,value:(0,o.isObject)(n)?(0,o.isElement)(n)?n.outerHTML:(0,o.clone)(n):n}]),[])}};t.LoggerTracer=a,t.LoggerTracer=a=r([(0,i.injectable)()],a)},62453:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OperationTracer=void 0;const a=n(38400),c=n(93176),s=n(68947),u=n(60131),l=n(98392);let f=class{constructor(e){this.main=e,this.operationTracer=[],this.localScope={},this.globalScope={}}pop({type:e}){const t=this.operationHandler(e).scope(),n={[c.OperationScope.BLOCK]:this.popBlock.bind(this),[c.OperationScope.LOCAL]:this.popLocal.bind(this)};n[t]?.(),this.localScope={}}push(e,t,n){this.localScope=n;const r={...this.mapOperation(e),position:+t},[i,...o]=this.operationTracer;if(!i)return void(this.operationTracer=[r]);const a=!(0,l.isBlockedScope)(this.operationHandler(i?.type));this.operationTracer=a?[r,...o]:[r,i,...o]}replaceFirst(e){if(0===this.operationTracer.length)return;const[{position:t,type:n,var:r},...i]=this.operationTracer;this.operationTracer=[{...e,position:t,var:r,type:n},...i]}trace(){const e=this.clonedScope(this.globalScope);return{scope:{local:this.clonedScope(this.localScope,e),global:e},trace:this.operationTracer}}init(e){this.localScope={},this.operationTracer=[],this.globalScope=e}clonedScope(e,t={}){const n=Object.keys(t);return Object.entries(e).reduce(((e,[t,r])=>({...e,...!n.includes(t)&&{[t]:(0,l.isObject)(r)?(0,l.isElement)(r)?r.outerHTML:(0,l.clone)(r):r}})),{})}popBlock(){const e=this.operationTracer.findIndex((({type:e})=>(0,l.isBlockedScope)(this.operationHandler(e))));-1!==e&&(this.operationTracer=this.operationTracer.slice(e+1))}popLocal(){this.operationTracer=this.operationTracer.slice(1)}operationHandler(e){return this.main.getOperationsList()[e]}mapOperation(e){const t={[c.OperationType.AND]:({operations:e,...t})=>({...t}),[c.OperationType.OR]:({operations:e,...t})=>({...t}),[c.OperationType.FOR_EACH]:({forEach:e,...t})=>({...t}),[c.OperationType.SPLIT_SCOPE]:({operations:e,...t})=>({...t})}[e.type];return t?t(e):e}};t.OperationTracer=f,t.OperationTracer=f=r([(0,a.injectable)(),o(0,(0,a.inject)(s.Injections.program)),i("design:paramtypes",[u.Program])],f)},73238:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Tracer=void 0;const a=n(38400),c=n(68947),s=n(99664),u=n(62453);let l=class{constructor(e,t){this.loggerTracer=e,this.operationTracer=t}init(e){this.operationTracer.init(e),this.loggerTracer.clear()}trace(e){return{version:this.version(),error:this.operationTracer.trace(),logs:this.loggerTracer.trace(),...e&&{message:e}}}version(){return"1.1.0"}};t.Tracer=l,t.Tracer=l=r([(0,a.injectable)(),o(0,(0,a.inject)(c.Injections.loggerTracer)),o(1,(0,a.inject)(c.Injections.operationTracer)),i("design:paramtypes",[s.LoggerTracer,u.OperationTracer])],l)},98392:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deepFreeze=t.isBlockedScope=t.isObject=t.isElement=t.isFailed=t.clone=t.succeeded=t.failed=void 0;const r=n(93176);t.failed=(e=void 0,t="Something went wrong",n=r.OperationType.LITERAL)=>({success:!1,value:{type:n,value:e},message:t});var i;t.succeeded=e=>({success:!0,value:{type:r.OperationType.LITERAL,value:e}}),function(e){e.Array="Array",e.Event="Event",e.RegExp="RegExp",e.Element="Element",e.Date="Date",e.Map="Map",e.Set="Set",e.Primitive="Primitive",e.Object="Object"}(i||(i={}));t.clone=function e(n){const r={[i.Array]:()=>{const r=[];for(const i in n){const o=n[i];r[i]=(0,t.isObject)(o)?e(o):o}return r},[i.Event]:()=>n,[i.RegExp]:()=>n,[i.Element]:()=>n,[i.Date]:()=>new(0,n.constructor)(n),[i.Map]:()=>{const t=new(0,n.constructor);return n.forEach(((n,r)=>{t.set(r,e(n))})),t},[i.Set]:()=>{const t=new(0,n.constructor);return n.forEach((n=>{t.add(e(n))})),t},[i.Primitive]:()=>n,[i.Object]:()=>{const r=n,i={};for(const a in n){const c="function"==typeof(o=n[a])?o.bind(r):(0,t.isObject)(n)?e(o):o;void 0!==c&&(i[a]=c)}var o;return i}},o=(e=>{const n=[()=>Array.isArray(e)&&i.Array,()=>e instanceof Event&&i.Event,()=>e instanceof RegExp&&i.RegExp,()=>(0,t.isElement)(e)&&i.Element,()=>e instanceof Date&&i.Date,()=>e instanceof Map&&i.Map,()=>e instanceof Set&&i.Set,()=>!(0,t.isObject)(e)&&i.Primitive];for(const e of n){const t=e();if(t)return t}return i.Object})(n);return r[o]()},t.isFailed=function(e,t){return!e.success&&!t?.optional};t.isElement=e=>e instanceof Element||e instanceof Document;t.isObject=e=>"object"==typeof e&&null!==e;t.isBlockedScope=e=>e.scope()===r.OperationScope.BLOCK;t.deepFreeze=e=>{if(Object.isFrozen(e))return e;Object.values(e).forEach((e=>Object.isFrozen(e)||(0,t.deepFreeze)(e)));try{return Object.freeze(e)}catch{return e}}},38400:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AsyncContainerModule:()=>ct,BindingScopeEnum:()=>v,BindingTypeEnum:()=>m,Container:()=>ot,ContainerModule:()=>at,LazyServiceIdentifer:()=>z,LazyServiceIdentifier:()=>z,METADATA_KEY:()=>Tt,MetadataReader:()=>H,TargetTypeEnum:()=>b,createTaggedDecorator:()=>ft,decorate:()=>ht,getServiceIdentifierAsString:()=>V,id:()=>w,inject:()=>bt,injectable:()=>yt,interfaces:()=>St,multiBindToService:()=>be,multiInject:()=>Rt,named:()=>vt,namedConstraint:()=>Ge,optional:()=>_t,postConstruct:()=>Et,preDestroy:()=>At,tagged:()=>gt,taggedConstraint:()=>qe,targetName:()=>jt,traverseAncerstors:()=>Ue,typeConstraint:()=>We,unmanaged:()=>wt});var r={};n.r(r),n.d(r,{DESIGN_PARAM_TYPES:()=>p,INJECT_TAG:()=>s,MULTI_INJECT_TAG:()=>u,NAMED_TAG:()=>i,NAME_TAG:()=>o,NON_CUSTOM_TAG_KEYS:()=>g,OPTIONAL_TAG:()=>c,PARAM_TYPES:()=>d,POST_CONSTRUCT:()=>h,PRE_DESTROY:()=>y,TAGGED:()=>l,TAGGED_PROP:()=>f,UNMANAGED_TAG:()=>a});var i="named",o="name",a="unmanaged",c="optional",s="inject",u="multi_inject",l="inversify:tagged",f="inversify:tagged_props",d="inversify:paramtypes",p="design:paramtypes",h="post_construct",y="pre_destroy";var g=[s,u,o,a,i,c],v={Request:"Request",Singleton:"Singleton",Transient:"Transient"},m={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"},b={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"},_=0;function w(){return _++}var R=function(){function e(e,t){this.id=w(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=m.Invalid,this.constraint=function(e){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.onDeactivation=null,this.dynamicValue=null}return e.prototype.clone=function(){var t=new e(this.serviceIdentifier,this.scope);return t.activated=t.scope===v.Singleton&&this.activated,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.factory=this.factory,t.provider=this.provider,t.constraint=this.constraint,t.onActivation=this.onActivation,t.onDeactivation=this.onDeactivation,t.cache=this.cache,t},e}(),j="Cannot apply @injectable decorator multiple times.",O="Metadata key was used more than once in a parameter:",S="NULL argument",E="Key Not Found",A="Ambiguous match found for serviceIdentifier:",T="No matching bindings found for serviceIdentifier:",C="Missing required @injectable annotation in:",I="Missing required @inject or @multiInject annotation in:",M="Circular dependency found:",D="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.",P=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"The number of constructor arguments in the derived class "+e[0]+" must be >= than the number of constructor arguments of its base class."},N=function(e,t){return"@postConstruct error in class "+e+": "+t},L=function(e,t){return"@preDestroy error in class "+e+": "+t},x=function(e,t){return"onDeactivation() error in class "+e+": "+t},F="Maximum call stack size exceeded",H=function(){function e(){}return e.prototype.getConstructorMetadata=function(e){return{compilerGeneratedMetadata:Reflect.getMetadata(d,e),userGeneratedMetadata:Reflect.getMetadata(l,e)||{}}},e.prototype.getPropertiesMetadata=function(e){return Reflect.getMetadata(f,e)||[]},e}(),B={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};function k(e){return e instanceof RangeError||e.message===F}function V(e){return"function"==typeof e?e.name:"symbol"==typeof e?e.toString():e}function U(e,t,n){var r="",i=n(e,t);return 0!==i.length&&(r="\nRegistered bindings:",i.forEach((function(e){var t="Object";null!==e.implementationType&&(t=W(e.implementationType)),r=r+"\n "+t,e.constraint.metaData&&(r=r+" - "+e.constraint.metaData)}))),r}function q(e,t){return null!==e.parentRequest&&(e.parentRequest.serviceIdentifier===t||q(e.parentRequest,t))}function G(e){e.childRequests.forEach((function(e){if(q(e,e.serviceIdentifier)){var t=function(e){var t=function e(t,n){void 0===n&&(n=[]);var r=V(t.serviceIdentifier);return n.push(r),null!==t.parentRequest?e(t.parentRequest,n):n}(e);return t.reverse().join(" --\x3e ")}(e);throw new Error(M+" "+t)}G(e)}))}function W(e){if(e.name)return e.name;var t=e.toString(),n=t.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+t}var K=function(){function e(e){this.id=w(),this.container=e}return e.prototype.addPlan=function(e){this.plan=e},e.prototype.setCurrentRequest=function(e){this.currentRequest=e},e}(),$=function(){function e(e,t){this.key=e,this.value=t}return e.prototype.toString=function(){return this.key===i?"named: "+String(this.value).toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+String(this.value)+" }"},e}(),Y=function(e,t){this.parentContext=e,this.rootRequest=t},z=function(){function e(e){this._cb=e}return e.prototype.unwrap=function(){return this._cb()},e}(),J=function(){function e(e){this.str=e}return e.prototype.startsWith=function(e){return 0===this.str.indexOf(e)},e.prototype.endsWith=function(e){var t,n=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},e.prototype.contains=function(e){return-1!==this.str.indexOf(e)},e.prototype.equals=function(e){return this.str===e},e.prototype.value=function(){return this.str},e}(),Z=function(){function e(e,t,n,r){this.id=w(),this.type=e,this.serviceIdentifier=n;var o="symbol"==typeof t?t.toString().slice(7,-1):t;this.name=new J(o||""),this.identifier=t,this.metadata=new Array;var a=null;"string"==typeof r?a=new $(i,r):r instanceof $&&(a=r),null!==a&&this.metadata.push(a)}return e.prototype.hasTag=function(e){for(var t=0,n=this.metadata;t<n.length;t++){if(n[t].key===e)return!0}return!1},e.prototype.isArray=function(){return this.hasTag(u)},e.prototype.matchesArray=function(e){return this.matchesTag(u)(e)},e.prototype.isNamed=function(){return this.hasTag(i)},e.prototype.isTagged=function(){return this.metadata.some((function(e){return g.every((function(t){return e.key!==t}))}))},e.prototype.isOptional=function(){return this.matchesTag(c)(!0)},e.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter((function(e){return e.key===i}))[0]:null},e.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter((function(e){return g.every((function(t){return e.key!==t}))})):null},e.prototype.matchesNamedTag=function(e){return this.matchesTag(i)(e)},e.prototype.matchesTag=function(e){var t=this;return function(n){for(var r=0,i=t.metadata;r<i.length;r++){var o=i[r];if(o.key===e&&o.value===n)return!0}return!1}},e}(),X=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};function Q(e,t,n,r){var i=e.getConstructorMetadata(n),o=i.compilerGeneratedMetadata;if(void 0===o)throw new Error(C+" "+t+".");var a=i.userGeneratedMetadata,c=Object.keys(a),s=0===n.length&&c.length>0,u=c.length>n.length,l=function(e,t,n,r,i){for(var o=[],a=0;a<i;a++){var c=ee(a,e,t,n,r);null!==c&&o.push(c)}return o}(r,t,o,a,s||u?c.length:n.length),f=ne(e,n,t);return X(X([],l,!0),f,!0)}function ee(e,t,n,r,i){var o=i[e.toString()]||[],a=ie(o),c=!0!==a.unmanaged,s=r[e],u=a.inject||a.multiInject;if((s=u||s)instanceof z&&(s=s.unwrap()),c){if(!t&&(s===Object||s===Function||void 0===s))throw new Error(I+" argument "+e+" in class "+n+".");var l=new Z(b.ConstructorArgument,a.targetName,s);return l.metadata=o,l}return null}function te(e,t,n,r){var i=e||t;if(void 0===i){var o=C+" for property "+String(n)+" in class "+r+".";throw new Error(o)}return i}function ne(e,t,n){for(var r=e.getPropertiesMetadata(t),i=[],o=Object.getOwnPropertySymbols(r),a=0,c=Object.keys(r).concat(o);a<c.length;a++){var s=c[a],u=r[s],l=ie(u),f=l.targetName||s,d=te(l.inject,l.multiInject,s,n),p=new Z(b.ClassProperty,f,d);p.metadata=u,i.push(p)}var h=Object.getPrototypeOf(t.prototype).constructor;if(h!==Object){var y=ne(e,h,n);i=X(X([],i,!0),y,!0)}return i}function re(e,t){var n=Object.getPrototypeOf(t.prototype).constructor;if(n!==Object){var r=Q(e,W(n),n,!0),i=r.map((function(e){return e.metadata.filter((function(e){return e.key===a}))})),o=[].concat.apply([],i).length,c=r.length-o;return c>0?c:re(e,n)}return 0}function ie(e){var t={};return e.forEach((function(e){t[e.key.toString()]=e.value})),{inject:t[s],multiInject:t[u],targetName:t[o],unmanaged:t[a]}}var oe=function(){function e(e,t,n,r,i){this.id=w(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=n,this.target=i,this.childRequests=[],this.bindings=Array.isArray(r)?r:[r],this.requestScope=null===n?new Map:null}return e.prototype.addChildRequest=function(t,n,r){var i=new e(t,this.parentContext,this,n,r);return this.childRequests.push(i),i},e}();function ae(e){return e._bindingDictionary}function ce(e,t,n,r,i){var o=ue(n.container,i.serviceIdentifier),a=[];return o.length===B.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"==typeof i.serviceIdentifier&&e.getConstructorMetadata(i.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(i.serviceIdentifier).toSelf(),o=ue(n.container,i.serviceIdentifier)),a=t?o:o.filter((function(e){var t=new oe(e.serviceIdentifier,n,r,e,i);return e.constraint(t)})),function(e,t,n,r){switch(t.length){case B.NoBindingsAvailable:if(n.isOptional())return t;var i=V(e),o=T;throw o+=function(e,t){if(t.isTagged()||t.isNamed()){var n="",r=t.getNamedTag(),i=t.getCustomTags();return null!==r&&(n+=r.toString()+"\n"),null!==i&&i.forEach((function(e){n+=e.toString()+"\n"}))," "+e+"\n "+e+" - "+n}return" "+e}(i,n),o+=U(r,i,ue),new Error(o);case B.OnlyOneBindingAvailable:return t;case B.MultipleBindingsAvailable:default:if(n.isArray())return t;i=V(e),o=A+" "+i;throw o+=U(r,i,ue),new Error(o)}}(i.serviceIdentifier,a,i,n.container),a}function se(e,t,n,r,i,o){var a,c;if(null===i){a=ce(e,t,r,null,o),c=new oe(n,r,null,a,o);var s=new Y(r,c);r.addPlan(s)}else a=ce(e,t,r,i,o),c=i.addChildRequest(o.serviceIdentifier,a,o);a.forEach((function(t){var n=null;if(o.isArray())n=c.addChildRequest(t.serviceIdentifier,t,o);else{if(t.cache)return;n=c}if(t.type===m.Instance&&null!==t.implementationType){var i=function(e,t){return Q(e,W(t),t,!1)}(e,t.implementationType);if(!r.container.options.skipBaseClassChecks){var a=re(e,t.implementationType);if(i.length<a){var s=P(W(t.implementationType));throw new Error(s)}}i.forEach((function(t){se(e,!1,t.serviceIdentifier,r,n,t)}))}}))}function ue(e,t){var n=[],r=ae(e);return r.hasKey(t)?n=r.get(t):null!==e.parent&&(n=ue(e.parent,t)),n}function le(e,t,n,r,i,o,a,c){void 0===c&&(c=!1);var l=new K(t),f=function(e,t,n,r,i,o){var a=new $(e?u:s,n),c=new Z(t,r,n,a);if(void 0!==i){var l=new $(i,o);c.metadata.push(l)}return c}(n,r,i,"",o,a);try{return se(e,c,i,l,null,f),l}catch(e){throw k(e)&&G(l.plan.rootRequest),e}}function fe(e){return("object"==typeof e&&null!==e||"function"==typeof e)&&"function"==typeof e.then}function de(e){return!!fe(e)||Array.isArray(e)&&e.some(fe)}var pe,he=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},ye=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},ge=function(e,t,n){e.has(t.id)||e.set(t.id,n)},ve=function(e,t){e.cache=t,e.activated=!0,fe(t)&&me(e,t)},me=function(e,t){return he(void 0,void 0,void 0,(function(){var n,r;return ye(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,t];case 1:return n=i.sent(),e.cache=n,[3,3];case 2:throw r=i.sent(),e.cache=null,e.activated=!1,r;case 3:return[2]}}))}))};!function(e){e.DynamicValue="toDynamicValue",e.Factory="toFactory",e.Provider="toProvider"}(pe||(pe={}));var be=function(e){return function(t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n.forEach((function(n){return e.bind(n).toService(t)}))}}},_e=function(){return _e=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},_e.apply(this,arguments)},we=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Re=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},je=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};function Oe(e,t,n){var r;if(t.length>0){var i=function(e,t){return e.reduce((function(e,n){var r=t(n);return n.target.type===b.ConstructorArgument?e.constructorInjections.push(r):(e.propertyRequests.push(n),e.propertyInjections.push(r)),e.isAsync||(e.isAsync=de(r)),e}),{constructorInjections:[],propertyInjections:[],propertyRequests:[],isAsync:!1})}(t,n),o=_e(_e({},i),{constr:e});r=i.isAsync?function(e){return we(this,void 0,void 0,(function(){var t,n;return Re(this,(function(r){switch(r.label){case 0:return[4,Ee(e.constructorInjections)];case 1:return t=r.sent(),[4,Ee(e.propertyInjections)];case 2:return n=r.sent(),[2,Se(_e(_e({},e),{constructorInjections:t,propertyInjections:n}))]}}))}))}(o):Se(o)}else r=new e;return r}function Se(e){var t,n=new((t=e.constr).bind.apply(t,je([void 0],e.constructorInjections,!1)));return e.propertyRequests.forEach((function(t,r){var i=t.target.identifier,o=e.propertyInjections[r];t.target.isOptional()&&void 0===o||(n[i]=o)})),n}function Ee(e){return we(this,void 0,void 0,(function(){var t,n,r,i;return Re(this,(function(o){for(t=[],n=0,r=e;n<r.length;n++)i=r[n],Array.isArray(i)?t.push(Promise.all(i)):t.push(i);return[2,Promise.all(t)]}))}))}function Ae(e,t){var n=function(e,t){var n,r;if(Reflect.hasMetadata(h,e)){var i=Reflect.getMetadata(h,e);try{return null===(r=(n=t)[i.value])||void 0===r?void 0:r.call(n)}catch(t){if(t instanceof Error)throw new Error(N(e.name,t.message))}}}(e,t);return fe(n)?n.then((function(){return t})):t}function Te(e,t){e.scope!==v.Singleton&&function(e,t){var n="Class cannot be instantiated in "+(e.scope===v.Request?"request":"transient")+" scope.";if("function"==typeof e.onDeactivation)throw new Error(x(t.name,n));if(Reflect.hasMetadata(y,t))throw new Error(L(t.name,n))}(e,t)}var Ce=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},Ie=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Me=function(e){return function(t){t.parentContext.setCurrentRequest(t);var n=t.bindings,r=t.childRequests,i=t.target&&t.target.isArray(),o=!(t.parentRequest&&t.parentRequest.target&&t.target&&t.parentRequest.target.matchesArray(t.target.serviceIdentifier));if(i&&o)return r.map((function(t){return Me(e)(t)}));if(!t.target.isOptional()||0!==n.length){var a=n[0];return Le(e,t,a)}}},De=function(e,t){var n=function(e){switch(e.type){case m.Factory:return{factory:e.factory,factoryType:pe.Factory};case m.Provider:return{factory:e.provider,factoryType:pe.Provider};case m.DynamicValue:return{factory:e.dynamicValue,factoryType:pe.DynamicValue};default:throw new Error("Unexpected factory type "+e.type)}}(e);return function(e,t){try{return e()}catch(e){throw k(e)&&(e=t()),e}}((function(){return n.factory.bind(e)(t)}),(function(){return new Error((e=n.factoryType,r=t.currentRequest.serviceIdentifier.toString(),"It looks like there is a circular dependency in one of the '"+e+"' bindings. Please investigate bindings with service identifier '"+r+"'."));var e,r}))},Pe=function(e,t,n){var r,i=t.childRequests;switch(function(e){var t=null;switch(e.type){case m.ConstantValue:case m.Function:t=e.cache;break;case m.Constructor:case m.Instance:t=e.implementationType;break;case m.DynamicValue:t=e.dynamicValue;break;case m.Provider:t=e.provider;break;case m.Factory:t=e.factory}if(null===t){var n=V(e.serviceIdentifier);throw new Error("Invalid binding type: "+n)}}(n),n.type){case m.ConstantValue:case m.Function:r=n.cache;break;case m.Constructor:r=n.implementationType;break;case m.Instance:r=function(e,t,n,r){Te(e,t);var i=Oe(t,n,r);return fe(i)?i.then((function(e){return Ae(t,e)})):Ae(t,i)}(n,n.implementationType,i,Me(e));break;default:r=De(n,t.parentContext)}return r},Ne=function(e,t,n){var r=function(e,t){return t.scope===v.Singleton&&t.activated?t.cache:t.scope===v.Request&&e.has(t.id)?e.get(t.id):null}(e,t);return null!==r||function(e,t,n){t.scope===v.Singleton&&ve(t,n),t.scope===v.Request&&ge(e,t,n)}(e,t,r=n()),r},Le=function(e,t,n){return Ne(e,n,(function(){var r=Pe(e,t,n);return r=fe(r)?r.then((function(e){return xe(t,n,e)})):xe(t,n,r)}))};function xe(e,t,n){var r,i=Fe(e.parentContext,t,n),o=Ve(e.parentContext.container),a=o.next();do{r=a.value;var c=e.parentContext,s=e.serviceIdentifier,u=ke(r,s);i=fe(i)?Be(u,c,i):He(u,c,i),a=o.next()}while(!0!==a.done&&!ae(r).hasKey(e.serviceIdentifier));return i}var Fe=function(e,t,n){return"function"==typeof t.onActivation?t.onActivation(e,n):n},He=function(e,t,n){for(var r=e.next();!r.done;){if(fe(n=r.value(t,n)))return Be(e,t,n);r=e.next()}return n},Be=function(e,t,n){return Ce(void 0,void 0,void 0,(function(){var r,i;return Ie(this,(function(o){switch(o.label){case 0:return[4,n];case 1:r=o.sent(),i=e.next(),o.label=2;case 2:return i.done?[3,4]:[4,i.value(t,r)];case 3:return r=o.sent(),i=e.next(),[3,2];case 4:return[2,r]}}))}))},ke=function(e,t){var n=e._activations;return n.hasKey(t)?n.get(t).values():[].values()},Ve=function(e){for(var t=[e],n=e.parent;null!==n;)t.push(n),n=n.parent;return{next:function(){var e=t.pop();return void 0!==e?{done:!1,value:e}:{done:!0,value:void 0}}}};var Ue=function(e,t){var n=e.parentRequest;return null!==n&&(!!t(n)||Ue(n,t))},qe=function(e){return function(t){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(e)(t)};return n.metaData=new $(e,t),n}},Ge=qe(i),We=function(e){return function(t){var n=null;if(null!==t){if(n=t.bindings[0],"string"==typeof e)return n.serviceIdentifier===e;var r=t.bindings[0].implementationType;return e===r}return!1}},Ke=function(){function e(e){this._binding=e}return e.prototype.when=function(e){return this._binding.constraint=e,new $e(this._binding)},e.prototype.whenTargetNamed=function(e){return this._binding.constraint=Ge(e),new $e(this._binding)},e.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){return null!==e&&(null!==e.target&&!e.target.isNamed()&&!e.target.isTagged())},new $e(this._binding)},e.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=qe(e)(t),new $e(this._binding)},e.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return null!==t&&We(e)(t.parentRequest)},new $e(this._binding)},e.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return null!==t&&Ge(e)(t.parentRequest)},new $e(this._binding)},e.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(n){return null!==n&&qe(e)(t)(n.parentRequest)},new $e(this._binding)},e.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return null!==t&&Ue(t,We(e))},new $e(this._binding)},e.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return null!==t&&!Ue(t,We(e))},new $e(this._binding)},e.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return null!==t&&Ue(t,Ge(e))},new $e(this._binding)},e.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return null!==t&&!Ue(t,Ge(e))},new $e(this._binding)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(n){return null!==n&&Ue(n,qe(e)(t))},new $e(this._binding)},e.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(n){return null!==n&&!Ue(n,qe(e)(t))},new $e(this._binding)},e.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return null!==t&&Ue(t,e)},new $e(this._binding)},e.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return null!==t&&!Ue(t,e)},new $e(this._binding)},e}(),$e=function(){function e(e){this._binding=e}return e.prototype.onActivation=function(e){return this._binding.onActivation=e,new Ke(this._binding)},e.prototype.onDeactivation=function(e){return this._binding.onDeactivation=e,new Ke(this._binding)},e}(),Ye=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new Ke(this._binding),this._bindingOnSyntax=new $e(this._binding)}return e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e.prototype.onDeactivation=function(e){return this._bindingOnSyntax.onDeactivation(e)},e}(),ze=function(){function e(e){this._binding=e}return e.prototype.inRequestScope=function(){return this._binding.scope=v.Request,new Ye(this._binding)},e.prototype.inSingletonScope=function(){return this._binding.scope=v.Singleton,new Ye(this._binding)},e.prototype.inTransientScope=function(){return this._binding.scope=v.Transient,new Ye(this._binding)},e}(),Je=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new Ke(this._binding),this._bindingOnSyntax=new $e(this._binding),this._bindingInSyntax=new ze(e)}return e.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},e.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},e.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e.prototype.onDeactivation=function(e){return this._bindingOnSyntax.onDeactivation(e)},e}(),Ze=function(){function e(e){this._binding=e}return e.prototype.to=function(e){return this._binding.type=m.Instance,this._binding.implementationType=e,new Je(this._binding)},e.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw new Error("The toSelf function can only be applied when a constructor is used as service identifier");var e=this._binding.serviceIdentifier;return this.to(e)},e.prototype.toConstantValue=function(e){return this._binding.type=m.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=v.Singleton,new Ye(this._binding)},e.prototype.toDynamicValue=function(e){return this._binding.type=m.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new Je(this._binding)},e.prototype.toConstructor=function(e){return this._binding.type=m.Constructor,this._binding.implementationType=e,this._binding.scope=v.Singleton,new Ye(this._binding)},e.prototype.toFactory=function(e){return this._binding.type=m.Factory,this._binding.factory=e,this._binding.scope=v.Singleton,new Ye(this._binding)},e.prototype.toFunction=function(e){if("function"!=typeof e)throw new Error("Value provided to function binding must be a function!");var t=this.toConstantValue(e);return this._binding.type=m.Function,this._binding.scope=v.Singleton,t},e.prototype.toAutoFactory=function(e){return this._binding.type=m.Factory,this._binding.factory=function(t){return function(){return t.container.get(e)}},this._binding.scope=v.Singleton,new Ye(this._binding)},e.prototype.toAutoNamedFactory=function(e){return this._binding.type=m.Factory,this._binding.factory=function(t){return function(n){return t.container.getNamed(e,n)}},new Ye(this._binding)},e.prototype.toProvider=function(e){return this._binding.type=m.Provider,this._binding.provider=e,this._binding.scope=v.Singleton,new Ye(this._binding)},e.prototype.toService=function(e){this.toDynamicValue((function(t){return t.container.get(e)}))},e}(),Xe=function(){function e(){}return e.of=function(t,n,r,i,o){var a=new e;return a.bindings=t,a.middleware=n,a.deactivations=i,a.activations=r,a.moduleActivationStore=o,a},e}();var Qe=function(){function e(){this._map=new Map}return e.prototype.getMap=function(){return this._map},e.prototype.add=function(e,t){if(null==e)throw new Error(S);if(null==t)throw new Error(S);var n=this._map.get(e);void 0!==n?n.push(t):this._map.set(e,[t])},e.prototype.get=function(e){if(null==e)throw new Error(S);var t=this._map.get(e);if(void 0!==t)return t;throw new Error(E)},e.prototype.remove=function(e){if(null==e)throw new Error(S);if(!this._map.delete(e))throw new Error(E)},e.prototype.removeIntersection=function(e){var t=this;this.traverse((function(n,r){var i=e.hasKey(n)?e.get(n):void 0;if(void 0!==i){var o=r.filter((function(e){return!i.some((function(t){return e===t}))}));t._setValue(n,o)}}))},e.prototype.removeByCondition=function(e){var t=this,n=[];return this._map.forEach((function(r,i){for(var o=[],a=0,c=r;a<c.length;a++){var s=c[a];e(s)?n.push(s):o.push(s)}t._setValue(i,o)})),n},e.prototype.hasKey=function(e){if(null==e)throw new Error(S);return this._map.has(e)},e.prototype.clone=function(){var t=new e;return this._map.forEach((function(e,n){e.forEach((function(e){return t.add(n,"object"==typeof(r=e)&&null!==r&&"clone"in r&&"function"==typeof r.clone?e.clone():e);var r}))})),t},e.prototype.traverse=function(e){this._map.forEach((function(t,n){e(n,t)}))},e.prototype._setValue=function(e,t){t.length>0?this._map.set(e,t):this._map.delete(e)},e}(),et=function(){function e(){this._map=new Map}return e.prototype.remove=function(e){if(this._map.has(e)){var t=this._map.get(e);return this._map.delete(e),t}return this._getEmptyHandlersStore()},e.prototype.addDeactivation=function(e,t,n){this._getModuleActivationHandlers(e).onDeactivations.add(t,n)},e.prototype.addActivation=function(e,t,n){this._getModuleActivationHandlers(e).onActivations.add(t,n)},e.prototype.clone=function(){var t=new e;return this._map.forEach((function(e,n){t._map.set(n,{onActivations:e.onActivations.clone(),onDeactivations:e.onDeactivations.clone()})})),t},e.prototype._getModuleActivationHandlers=function(e){var t=this._map.get(e);return void 0===t&&(t=this._getEmptyHandlersStore(),this._map.set(e,t)),t},e.prototype._getEmptyHandlersStore=function(){return{onActivations:new Qe,onDeactivations:new Qe}},e}(),tt=function(){return tt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},tt.apply(this,arguments)},nt=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((r=r.apply(e,t||[])).next())}))},rt=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},it=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},ot=function(){function e(e){var t=e||{};if("object"!=typeof t)throw new Error("Invalid Container constructor argument. Container options must be an object.");if(void 0===t.defaultScope)t.defaultScope=v.Transient;else if(t.defaultScope!==v.Singleton&&t.defaultScope!==v.Transient&&t.defaultScope!==v.Request)throw new Error('Invalid Container option. Default scope must be a string ("singleton" or "transient").');if(void 0===t.autoBindInjectable)t.autoBindInjectable=!1;else if("boolean"!=typeof t.autoBindInjectable)throw new Error("Invalid Container option. Auto bind injectable must be a boolean");if(void 0===t.skipBaseClassChecks)t.skipBaseClassChecks=!1;else if("boolean"!=typeof t.skipBaseClassChecks)throw new Error("Invalid Container option. Skip base check must be a boolean");this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=w(),this._bindingDictionary=new Qe,this._snapshots=[],this._middleware=null,this._activations=new Qe,this._deactivations=new Qe,this.parent=null,this._metadataReader=new H,this._moduleActivationStore=new et}return e.merge=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var o=new e,a=it([t,n],r,!0).map((function(e){return ae(e)})),c=ae(o);return a.forEach((function(e){var t;t=c,e.traverse((function(e,n){n.forEach((function(e){t.add(e.serviceIdentifier,e.clone())}))}))})),o},e.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),r=0,i=e;r<i.length;r++){var o=i[r],a=n(o.id);o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction,a.unbindAsyncFunction,a.onActivationFunction,a.onDeactivationFunction)}},e.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return nt(this,void 0,void 0,(function(){var t,n,r,i,o;return rt(this,(function(a){switch(a.label){case 0:t=this._getContainerModuleHelpersFactory(),n=0,r=e,a.label=1;case 1:return n<r.length?(i=r[n],o=t(i.id),[4,i.registry(o.bindFunction,o.unbindFunction,o.isboundFunction,o.rebindFunction,o.unbindAsyncFunction,o.onActivationFunction,o.onDeactivationFunction)]):[3,4];case 2:a.sent(),a.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.unload=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.forEach((function(t){var n=e._removeModuleBindings(t.id);e._deactivateSingletons(n),e._removeModuleHandlers(t.id)}))},e.prototype.unloadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return nt(this,void 0,void 0,(function(){var t,n,r,i;return rt(this,(function(o){switch(o.label){case 0:t=0,n=e,o.label=1;case 1:return t<n.length?(r=n[t],i=this._removeModuleBindings(r.id),[4,this._deactivateSingletonsAsync(i)]):[3,4];case 2:o.sent(),this._removeModuleHandlers(r.id),o.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))},e.prototype.bind=function(e){var t=this.options.defaultScope||v.Transient,n=new R(e,t);return this._bindingDictionary.add(e,n),new Ze(n)},e.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},e.prototype.rebindAsync=function(e){return nt(this,void 0,void 0,(function(){return rt(this,(function(t){switch(t.label){case 0:return[4,this.unbindAsync(e)];case 1:return t.sent(),[2,this.bind(e)]}}))}))},e.prototype.unbind=function(e){if(this._bindingDictionary.hasKey(e)){var t=this._bindingDictionary.get(e);this._deactivateSingletons(t)}this._removeServiceFromDictionary(e)},e.prototype.unbindAsync=function(e){return nt(this,void 0,void 0,(function(){var t;return rt(this,(function(n){switch(n.label){case 0:return this._bindingDictionary.hasKey(e)?(t=this._bindingDictionary.get(e),[4,this._deactivateSingletonsAsync(t)]):[3,2];case 1:n.sent(),n.label=2;case 2:return this._removeServiceFromDictionary(e),[2]}}))}))},e.prototype.unbindAll=function(){var e=this;this._bindingDictionary.traverse((function(t,n){e._deactivateSingletons(n)})),this._bindingDictionary=new Qe},e.prototype.unbindAllAsync=function(){return nt(this,void 0,void 0,(function(){var e,t=this;return rt(this,(function(n){switch(n.label){case 0:return e=[],this._bindingDictionary.traverse((function(n,r){e.push(t._deactivateSingletonsAsync(r))})),[4,Promise.all(e)];case 1:return n.sent(),this._bindingDictionary=new Qe,[2]}}))}))},e.prototype.onActivation=function(e,t){this._activations.add(e,t)},e.prototype.onDeactivation=function(e,t){this._deactivations.add(e,t)},e.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},e.prototype.isCurrentBound=function(e){return this._bindingDictionary.hasKey(e)},e.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,i,t)},e.prototype.isBoundTagged=function(e,t,n){var r=!1;if(this._bindingDictionary.hasKey(e)){var i=this._bindingDictionary.get(e),o=function(e,t,n,r){var i=new Z(b.Variable,"",t,new $(n,r)),o=new K(e);return new oe(t,o,null,[],i)}(this,e,t,n);r=i.some((function(e){return e.constraint(o)}))}return!r&&this.parent&&(r=this.parent.isBoundTagged(e,t,n)),r},e.prototype.snapshot=function(){this._snapshots.push(Xe.of(this._bindingDictionary.clone(),this._middleware,this._activations.clone(),this._deactivations.clone(),this._moduleActivationStore.clone()))},e.prototype.restore=function(){var e=this._snapshots.pop();if(void 0===e)throw new Error("No snapshot available to restore.");this._bindingDictionary=e.bindings,this._activations=e.activations,this._deactivations=e.deactivations,this._middleware=e.middleware,this._moduleActivationStore=e.moduleActivationStore},e.prototype.createChild=function(t){var n=new e(t||this.options);return n.parent=this,n},e.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce((function(e,t){return t(e)}),n)},e.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},e.prototype.get=function(e){var t=this._getNotAllArgs(e,!1);return this._getButThrowIfAsync(t)},e.prototype.getAsync=function(e){return nt(this,void 0,void 0,(function(){var t;return rt(this,(function(n){return t=this._getNotAllArgs(e,!1),[2,this._get(t)]}))}))},e.prototype.getTagged=function(e,t,n){var r=this._getNotAllArgs(e,!1,t,n);return this._getButThrowIfAsync(r)},e.prototype.getTaggedAsync=function(e,t,n){return nt(this,void 0,void 0,(function(){var r;return rt(this,(function(i){return r=this._getNotAllArgs(e,!1,t,n),[2,this._get(r)]}))}))},e.prototype.getNamed=function(e,t){return this.getTagged(e,i,t)},e.prototype.getNamedAsync=function(e,t){return this.getTaggedAsync(e,i,t)},e.prototype.getAll=function(e){var t=this._getAllArgs(e);return this._getButThrowIfAsync(t)},e.prototype.getAllAsync=function(e){var t=this._getAllArgs(e);return this._getAll(t)},e.prototype.getAllTagged=function(e,t,n){var r=this._getNotAllArgs(e,!0,t,n);return this._getButThrowIfAsync(r)},e.prototype.getAllTaggedAsync=function(e,t,n){var r=this._getNotAllArgs(e,!0,t,n);return this._getAll(r)},e.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,i,t)},e.prototype.getAllNamedAsync=function(e,t){return this.getAllTaggedAsync(e,i,t)},e.prototype.resolve=function(e){var t=this.isBound(e);t||this.bind(e).toSelf();var n=this.get(e);return t||this.unbind(e),n},e.prototype._preDestroy=function(e,t){var n,r;if(Reflect.hasMetadata(y,e))return null===(r=(n=t)[Reflect.getMetadata(y,e).value])||void 0===r?void 0:r.call(n)},e.prototype._removeModuleHandlers=function(e){var t=this._moduleActivationStore.remove(e);this._activations.removeIntersection(t.onActivations),this._deactivations.removeIntersection(t.onDeactivations)},e.prototype._removeModuleBindings=function(e){return this._bindingDictionary.removeByCondition((function(t){return t.moduleId===e}))},e.prototype._deactivate=function(e,t){var n=this,r=Object.getPrototypeOf(t).constructor;try{if(this._deactivations.hasKey(e.serviceIdentifier)){var i=this._deactivateContainer(t,this._deactivations.get(e.serviceIdentifier).values());if(fe(i))return this._handleDeactivationError(i.then((function(){return n._propagateContainerDeactivationThenBindingAndPreDestroyAsync(e,t,r)})),r)}var o=this._propagateContainerDeactivationThenBindingAndPreDestroy(e,t,r);if(fe(o))return this._handleDeactivationError(o,r)}catch(e){if(e instanceof Error)throw new Error(x(r.name,e.message))}},e.prototype._handleDeactivationError=function(e,t){return nt(this,void 0,void 0,(function(){var n;return rt(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e];case 1:return r.sent(),[3,3];case 2:if((n=r.sent())instanceof Error)throw new Error(x(t.name,n.message));return[3,3];case 3:return[2]}}))}))},e.prototype._deactivateContainer=function(e,t){for(var n=this,r=t.next();r.value;){var i=r.value(e);if(fe(i))return i.then((function(){return n._deactivateContainerAsync(e,t)}));r=t.next()}},e.prototype._deactivateContainerAsync=function(e,t){return nt(this,void 0,void 0,(function(){var n;return rt(this,(function(r){switch(r.label){case 0:n=t.next(),r.label=1;case 1:return n.value?[4,n.value(e)]:[3,3];case 2:return r.sent(),n=t.next(),[3,1];case 3:return[2]}}))}))},e.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(e,t){e._binding.moduleId=t},n=function(n){return function(r){var i=e.rebind(r);return t(i,n),i}},r=function(t){return function(n,r){e._moduleActivationStore.addActivation(t,n,r),e.onActivation(n,r)}},i=function(t){return function(n,r){e._moduleActivationStore.addDeactivation(t,n,r),e.onDeactivation(n,r)}};return function(o){return{bindFunction:(a=o,function(n){var r=e.bind(n);return t(r,a),r}),isboundFunction:function(t){return e.isBound(t)},onActivationFunction:r(o),onDeactivationFunction:i(o),rebindFunction:n(o),unbindFunction:function(t){return e.unbind(t)},unbindAsyncFunction:function(t){return e.unbindAsync(t)}};var a}},e.prototype._getAll=function(e){return Promise.all(this._get(e))},e.prototype._get=function(e){var t=tt(tt({},e),{contextInterceptor:function(e){return e},targetType:b.Variable});if(this._middleware){var n=this._middleware(t);if(null==n)throw new Error("Invalid return type in middleware. Middleware must return!");return n}return this._planAndResolve()(t)},e.prototype._getButThrowIfAsync=function(e){var t=this._get(e);if(de(t))throw new Error("You are attempting to construct '"+e.serviceIdentifier+"' in a synchronous way\n but it has asynchronous dependencies.");return t},e.prototype._getAllArgs=function(e){return{avoidConstraints:!0,isMultiInject:!0,serviceIdentifier:e}},e.prototype._getNotAllArgs=function(e,t,n,r){return{avoidConstraints:!1,isMultiInject:t,serviceIdentifier:e,key:n,value:r}},e.prototype._planAndResolve=function(){var e=this;return function(t){var n=le(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);return function(e){return Me(e.plan.rootRequest.requestScope)(e.plan.rootRequest)}(n=t.contextInterceptor(n))}},e.prototype._deactivateIfSingleton=function(e){var t=this;if(e.activated)return fe(e.cache)?e.cache.then((function(n){return t._deactivate(e,n)})):this._deactivate(e,e.cache)},e.prototype._deactivateSingletons=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if(fe(this._deactivateIfSingleton(r)))throw new Error("Attempting to unbind dependency with asynchronous destruction (@preDestroy or onDeactivation)")}},e.prototype._deactivateSingletonsAsync=function(e){return nt(this,void 0,void 0,(function(){var t=this;return rt(this,(function(n){switch(n.label){case 0:return[4,Promise.all(e.map((function(e){return t._deactivateIfSingleton(e)})))];case 1:return n.sent(),[2]}}))}))},e.prototype._propagateContainerDeactivationThenBindingAndPreDestroy=function(e,t,n){return this.parent?this._deactivate.bind(this.parent)(e,t):this._bindingDeactivationAndPreDestroy(e,t,n)},e.prototype._propagateContainerDeactivationThenBindingAndPreDestroyAsync=function(e,t,n){return nt(this,void 0,void 0,(function(){return rt(this,(function(r){switch(r.label){case 0:return this.parent?[4,this._deactivate.bind(this.parent)(e,t)]:[3,2];case 1:return r.sent(),[3,4];case 2:return[4,this._bindingDeactivationAndPreDestroyAsync(e,t,n)];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))},e.prototype._removeServiceFromDictionary=function(e){try{this._bindingDictionary.remove(e)}catch(t){throw new Error("Could not unbind serviceIdentifier: "+V(e))}},e.prototype._bindingDeactivationAndPreDestroy=function(e,t,n){var r=this;if("function"==typeof e.onDeactivation){var i=e.onDeactivation(t);if(fe(i))return i.then((function(){return r._preDestroy(n,t)}))}return this._preDestroy(n,t)},e.prototype._bindingDeactivationAndPreDestroyAsync=function(e,t,n){return nt(this,void 0,void 0,(function(){return rt(this,(function(r){switch(r.label){case 0:return"function"!=typeof e.onDeactivation?[3,2]:[4,e.onDeactivation(t)];case 1:r.sent(),r.label=2;case 2:return[4,this._preDestroy(n,t)];case 3:return r.sent(),[2]}}))}))},e}(),at=function(e){this.id=w(),this.registry=e},ct=function(e){this.id=w(),this.registry=e};function st(e,t,n,r){!function(e){if(void 0!==e)throw new Error(D)}(t),lt(l,e,n.toString(),r)}function ut(e){var t=[];if(Array.isArray(e)){var n=function(e){for(var t=new Set,n=0,r=e;n<r.length;n++){var i=r[n];if(t.has(i))return i;t.add(i)}}((t=e).map((function(e){return e.key})));if(void 0!==n)throw new Error(O+" "+n.toString())}else t=[e];return t}function lt(e,t,n,r){var i=ut(r),o={};Reflect.hasOwnMetadata(e,t)&&(o=Reflect.getMetadata(e,t));var a=o[n];if(void 0===a)a=[];else for(var c=function(e){if(i.some((function(t){return t.key===e.key})))throw new Error(O+" "+e.key.toString())},s=0,u=a;s<u.length;s++){c(u[s])}a.push.apply(a,i),o[n]=a,Reflect.defineMetadata(e,o,t)}function ft(e){return function(t,n,r){"number"==typeof r?st(t,n,r,e):function(e,t,n){if(void 0!==e.prototype)throw new Error(D);lt(f,e.constructor,t,n)}(t,n,e)}}function dt(e,t){Reflect.decorate(e,t)}function pt(e,t){return function(n,r){t(n,r,e)}}function ht(e,t,n){"number"==typeof n?dt([pt(n,e)],t):"string"==typeof n?Reflect.decorate([e],t,n):dt([e],t)}function yt(){return function(e){if(Reflect.hasOwnMetadata(d,e))throw new Error(j);var t=Reflect.getMetadata(p,e)||[];return Reflect.defineMetadata(d,t,e),e}}function gt(e,t){return ft(new $(e,t))}function vt(e){return ft(new $(i,e))}function mt(e){return function(t){return function(n,r,i){if(void 0===t){var o="function"==typeof n?n.name:n.constructor.name;throw new Error("@inject called with undefined this could mean that the class "+o+" has a circular dependency problem. You can use a LazyServiceIdentifier to  overcome this limitation.")}return ft(new $(e,t))(n,r,i)}}}var bt=mt(s);function _t(){return ft(new $(c,!0))}function wt(){return function(e,t,n){st(e,t,n,new $(a,!0))}}var Rt=mt(u);function jt(e){return function(t,n,r){st(t,n,r,new $(o,e))}}function Ot(e,t){return function(){return function(n,r){var i=new $(e,r);if(Reflect.hasOwnMetadata(e,n.constructor))throw new Error(t);Reflect.defineMetadata(e,i,n.constructor)}}}var St,Et=Ot(h,"Cannot apply @postConstruct decorator multiple times in the same class"),At=Ot(y,"Cannot apply @preDestroy decorator multiple times in the same class");St||(St={});var Tt=r},28660:(e,t,n)=>{var r;!function(e){!function(t){var r="object"==typeof n.g?n.g:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),i=o(e);function o(e,t){return function(n,r){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}void 0===r.Reflect?r.Reflect=e:i=o(r.Reflect,i),function(e){var t=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,r=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,a={__proto__:[]}instanceof Array,c=!o&&!a,s={create:o?function(){return re(Object.create(null))}:a?function(){return re({__proto__:null})}:function(){return re({})},has:c?function(e,n){return t.call(e,n)}:function(e,t){return t in e},get:c?function(e,n){return t.call(e,n)?e[n]:void 0}:function(e,t){return e[t]}},u=Object.getPrototypeOf(Function),l="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,f=l||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?ee():Map,d=l||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?te():Set,p=new(l||"function"!=typeof WeakMap?ne():WeakMap);function h(e,t,n,r){if(L(n)){if(!G(e))throw new TypeError;if(!K(t))throw new TypeError;return O(e,t)}if(!G(e))throw new TypeError;if(!H(t))throw new TypeError;if(!H(r)&&!L(r)&&!x(r))throw new TypeError;return x(r)&&(r=void 0),S(e,t,n=q(n),r)}function y(e,t){function n(n,r){if(!H(n))throw new TypeError;if(!L(r)&&!$(r))throw new TypeError;M(e,t,n,r)}return n}function g(e,t,n,r){if(!H(n))throw new TypeError;return L(r)||(r=q(r)),M(e,t,n,r)}function v(e,t,n){if(!H(t))throw new TypeError;return L(n)||(n=q(n)),A(e,t,n)}function m(e,t,n){if(!H(t))throw new TypeError;return L(n)||(n=q(n)),T(e,t,n)}function b(e,t,n){if(!H(t))throw new TypeError;return L(n)||(n=q(n)),C(e,t,n)}function _(e,t,n){if(!H(t))throw new TypeError;return L(n)||(n=q(n)),I(e,t,n)}function w(e,t){if(!H(e))throw new TypeError;return L(t)||(t=q(t)),D(e,t)}function R(e,t){if(!H(e))throw new TypeError;return L(t)||(t=q(t)),P(e,t)}function j(e,t,n){if(!H(t))throw new TypeError;L(n)||(n=q(n));var r=E(t,n,!1);if(L(r))return!1;if(!r.delete(e))return!1;if(r.size>0)return!0;var i=p.get(t);return i.delete(n),i.size>0||p.delete(t),!0}function O(e,t){for(var n=e.length-1;n>=0;--n){var r=(0,e[n])(t);if(!L(r)&&!x(r)){if(!K(r))throw new TypeError;t=r}}return t}function S(e,t,n,r){for(var i=e.length-1;i>=0;--i){var o=(0,e[i])(t,n,r);if(!L(o)&&!x(o)){if(!H(o))throw new TypeError;r=o}}return r}function E(e,t,n){var r=p.get(e);if(L(r)){if(!n)return;r=new f,p.set(e,r)}var i=r.get(t);if(L(i)){if(!n)return;i=new f,r.set(t,i)}return i}function A(e,t,n){if(T(e,t,n))return!0;var r=Q(t);return!x(r)&&A(e,r,n)}function T(e,t,n){var r=E(t,n,!1);return!L(r)&&V(r.has(e))}function C(e,t,n){if(T(e,t,n))return I(e,t,n);var r=Q(t);return x(r)?void 0:C(e,r,n)}function I(e,t,n){var r=E(t,n,!1);if(!L(r))return r.get(e)}function M(e,t,n,r){E(n,r,!0).set(e,t)}function D(e,t){var n=P(e,t),r=Q(e);if(null===r)return n;var i=D(r,t);if(i.length<=0)return n;if(n.length<=0)return i;for(var o=new d,a=[],c=0,s=n;c<s.length;c++){var u=s[c];o.has(u)||(o.add(u),a.push(u))}for(var l=0,f=i;l<f.length;l++){u=f[l];o.has(u)||(o.add(u),a.push(u))}return a}function P(e,t){var n=[],r=E(e,t,!1);if(L(r))return n;for(var i=z(r.keys()),o=0;;){var a=Z(i);if(!a)return n.length=o,n;var c=J(a);try{n[o]=c}catch(e){try{X(i)}finally{throw e}}o++}}function N(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function L(e){return void 0===e}function x(e){return null===e}function F(e){return"symbol"==typeof e}function H(e){return"object"==typeof e?null!==e:"function"==typeof e}function B(e,t){switch(N(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",i=Y(e,r);if(void 0!==i){var o=i.call(e,n);if(H(o))throw new TypeError;return o}return k(e,"default"===n?"number":n)}function k(e,t){if("string"===t){var n=e.toString;if(W(n))if(!H(i=n.call(e)))return i;if(W(r=e.valueOf))if(!H(i=r.call(e)))return i}else{var r;if(W(r=e.valueOf))if(!H(i=r.call(e)))return i;var i,o=e.toString;if(W(o))if(!H(i=o.call(e)))return i}throw new TypeError}function V(e){return!!e}function U(e){return""+e}function q(e){var t=B(e,3);return F(t)?t:U(t)}function G(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function W(e){return"function"==typeof e}function K(e){return"function"==typeof e}function $(e){switch(N(e)){case 3:case 4:return!0;default:return!1}}function Y(e,t){var n=e[t];if(null!=n){if(!W(n))throw new TypeError;return n}}function z(e){var t=Y(e,i);if(!W(t))throw new TypeError;var n=t.call(e);if(!H(n))throw new TypeError;return n}function J(e){return e.value}function Z(e){var t=e.next();return!t.done&&t}function X(e){var t=e.return;t&&t.call(e)}function Q(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===u)return t;if(t!==u)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var i=r.constructor;return"function"!=typeof i||i===e?t:i}function ee(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[i]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,o)},t.prototype.entries=function(){return new n(this._keys,this._values,a)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[i]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function o(e,t){return t}function a(e,t){return[e,t]}}function te(){return function(){function e(){this._map=new f}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[i]=function(){return this.keys()},e}()}function ne(){var e=16,n=s.create(),r=i();return function(){function e(){this._key=i()}return e.prototype.has=function(e){var t=o(e,!1);return void 0!==t&&s.has(t,this._key)},e.prototype.get=function(e){var t=o(e,!1);return void 0!==t?s.get(t,this._key):void 0},e.prototype.set=function(e,t){return o(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=o(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=i()},e}();function i(){var e;do{e="@@WeakMap@@"+u()}while(s.has(n,e));return n[e]=!0,e}function o(e,n){if(!t.call(e,r)){if(!n)return;Object.defineProperty(e,r,{value:s.create()})}return e[r]}function a(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function c(e){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):a(new Uint8Array(e),e):a(new Array(e),e)}function u(){var t=c(e);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",r=0;r<e;++r){var i=t[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}function re(e){return e.__=void 0,delete e.__,e}e("decorate",h),e("metadata",y),e("defineMetadata",g),e("hasMetadata",v),e("hasOwnMetadata",m),e("getMetadata",b),e("getOwnMetadata",_),e("getMetadataKeys",w),e("getOwnMetadataKeys",R),e("deleteMetadata",j)}(i)}()}(r||(r={}))}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};(()=>{"use strict";n(28660);const e=n(1106),t=n(14476),r=n(91049),i=n(34679),o=n(11272),a=n(90208),c=n(63580),s=n(62825),u=n(36769),l=n(99808),f=n(50838),d=n(4234),p=n(43335),h=n(82134),y=n(47016),g=n(21042),v=n(71168),m=n(74990),b=n(1457);(new class{constructor(){this.initContainer()}init(){const e=this.container.get(s.ContentInjections.historyManager),t=this.container.get(s.ContentInjections.outContentMessageManager),n=this.container.get(s.ContentInjections.requestsManager);this.container.get(s.ContentInjections.inContentMessageManager),e.onShopifyDetected(t.initShopifyMessage.bind(t)),e.replaceNativeApi(),n.injectScript(),t.initMessage()}initContainer(){this.container=new c.Container,this.bindManagers(),this.bindConstants(),this.bindHandlers()}bindManagers(){const e={[s.ContentInjections.requestsManager]:a.RequestsManager,[s.ContentInjections.inContentMessageManager]:r.InContentMessageManager,[s.ContentInjections.outContentMessageManager]:t.OutContentMessageManager,[s.ContentInjections.historyManager]:i.HistoryManager,[s.ContentInjections.observer]:o.Observer,[s.ContentInjections.matcher]:u.Matcher,[s.ContentInjections.extractorManager]:m.ExtractorManager};Object.entries(e).forEach((([e,t])=>{this.bindSingleton(e,t)}))}bindConstants(){const t=(0,e.uuid)();this.container.bind(s.ContentInjections.ID).toConstantValue(t),this.container.bind(s.ContentInjections.DI).toConstantValue(this.container)}bindHandlers(){const e={[s.ContentInjections.interceptorsHandler]:l.InterceptorsHandler,[s.ContentInjections.onClickHandler]:f.OnClickHandler,[s.ContentInjections.onDomLoadHandler]:d.OnDomLoadHandler,[s.ContentInjections.onIframeLoadedHandler]:p.OnIframeLoadedHandler,[s.ContentInjections.onLoadHandler]:h.OnLoadHandler,[s.ContentInjections.onPostMessageHandler]:y.OnPostMessageHandler,[s.ContentInjections.onUrlChangedHandler]:g.OnUrlChangedHandler,[s.ContentInjections.onWindowLoadHandler]:v.OnWindowLoadHandler,[s.ContentInjections.onDomChangedHandler]:b.OnDomChangedHandler};Object.entries(e).forEach((([e,t])=>{this.bindSingleton(e,t)}))}bindSingleton(e,t){this.container.bind(e).to(t).inSingletonScope()}}).init()})()})();